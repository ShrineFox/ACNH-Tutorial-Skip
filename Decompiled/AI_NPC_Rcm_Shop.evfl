flow Check_Goods():
    MainNpc.NpcAISetting(9, false)
    MainNpc.NpcAISetting(5, false)
    MainNpc.SetNpcSpeakFlow('SNPC_rcm_00_Groceries', 'Root')
 
flow Check_rcm():
    if MainNpc.NpcBlackBoard('CheckItemIndex', 0):
        MainNpc.NpcAISetting(9, false)
        MainNpc.NpcAISetting(5, false)
        MainNpc.SetNpcSpeakFlow('SNPC_rcm', 'Check')
 
flow Close_rcm():
    run AI_NPC_Common::ContinueSpeakrun AI_NPC_Common::ContinueSpeak(EntryName='Root', FlowName='SNPC_rcm_00_Close')
 
flow Enter_rcm():
    MainNpc.NpcAISetting(13, true)
    MainNpc.NpcAISetting(18, true)
    run AI_NPC_Common::Speakrun AI_NPC_Common::Speak(EntryName='Root', FlowName='SNPC_rcm_00_In')
    System.EventFlags['cLandTemp:RcmEnterBalloon'] = true
    System.EventFlags['cLandTemp:ShopEnterMessageFlag'] = true
 
flow Init():
    MainNpc.SetSightRange(0, 64)
    MainNpc.NpcRegistAIBlackBoard('CheckItemIndex', -1)
    MainNpc.NpcRegistAIBlackBoard('DemoSpeak', 0)
    MainNpc.NpcAISetting(0, true)
    MainNpc.NpcAISetting(1, true)
    MainNpc.NpcAISetRequestSpeakFunc('cItemCheck', true)
    MainNpc.NpcRegistAIBlackBoard('GoodsRail', 2)
    MainNpc.NpcAISetRequestSpeakFunc('cLeaveRcm', true)
    MainNpc.NpcAISetRequestSpeakFunc('cEnterRcm', true)
    if EventFlowSystemActor.NetIsConnected():
        MainNpc.NpcAISetting(8, true)
        MainNpc.NpcChangeHeadCtrlMode('cPlayer', false)
        switch EventFlowSystemActor.ShopLevel():
            case `NooksCrannyInitial`:
                MainNpc.NpcAISetPosByRail(6, 0, true, -80.0)
                run Sub_grp_Event24()
            case `NooksCrannyUpgraded`:
                MainNpc.NpcAISetPosByRail(3, 0, true, 0.0)
                run Sub_grp_Event24()
            default:
                return
    else:
        MainNpc.NpcAISetRequestSpeakFunc('cShopClose', false)
        MainNpc.NpcAISetting(8, false)
        run Sub_grp_Event24()
 
flow Leave_rcm():
    run AI_NPC_Common::ContinueSpeakrun AI_NPC_Common::ContinueSpeak(EntryName='Root', FlowName='SNPC_rcm_00_Out')
 
flow Rcm_Wait():
    MainNpc.NpcAISetting(19, true)
    MainNpc.NpcChangeAIState('cRcm', '', 'SNPC_rcm', 'Root', false, true)
    MainNpc.NpcChangeHeadCtrlMode('cPlayer', false)
 
flow Root():
    if MainNpc.NpcCheckStateSelectTiming('cInit'):
        if EventFlowSystemActor.ShopLevel() in (`InResServiceTent`, `NooksCrannyUpgraded`):
            run Rcm_Wait()
        elif (EventFlowSystemActor.IsMyVillage()) and (MainNpc.HghFreeQuery2('cHghQueryType_HghStayMarket')):
            MainNpc.NpcChangeConversationPretenseState('cConversationPretense', '', 'SNPC_rcm', 'Root', false, true, ArgInt0=0, ArgStr0='hgh')
        else:
            run Rcm_Wait()
    elif MainNpc.NpcBlackBoard('DemoSpeak', 1):
        MainNpc.NpcAISetting(4, false)
        MainNpc.NpcSetAIBlackBoard('DemoSpeak', 0)
        MainNpc.NpcAISetting(3, false)
        MainNpc.NpcAISetting(2, false)
        run AI_NPC_Common::Speakrun AI_NPC_Common::Speak(EntryName='ForceRenualOpen', FlowName='SNPC_rcm')
    else:
        MainNpc.NpcAISetting(4, true)
        MainNpc.NpcChangeAIState('cRcm', '', 'SNPC_rcm', 'Root', false, true)
        MainNpc.NpcChangeHeadCtrlMode('cPlayer', false)
 
local flow Sub_grp_Event24():
    if MainNpc.HghFreeQuery2('cHghQueryType_HghStayMarket'):
        MainNpc.NpcAISetPosByRail(5, 0, false, 0.0)
        System.EventFlags['cLandTemp:HghStayMarketNow'] = true
 
