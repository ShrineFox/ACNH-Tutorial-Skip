flow BoxCheck(Price: int = 500):
	run FirstTalkFireworks_Setting()
	Player.TurnBody(0, 0.0)
	MainNpc.NpcAISetting(9, true)
	switch EventFlowSystemActor.EventCheck('Fireworks'):
		case 0:
			run TalkBeforeEvent()
		case 1:
			EventFlowSystemActor.SetTagFromSystem('cFlow', 'cMoney', 0, Price, '')
			EventFlowSystemActor.UIMoneyAppear()
			# Step right up! Step right up to Redd's Raffle!
			MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:001', false)
			switch SubflowResults@4[1]:
				case 0:
					pass
				case 1:
					# Oh! Why, I don't believe you and I have had the pleasure. The name's Redd. I work in sales. And you are…<10:4> <50:3>PLAYER! What a great name! Intel…
					MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:002_01', false)
					run Sub_Event142(Price=Price)
				case 2:
					# Either I'm seeing things or it's none other than my favorite cousin! How are ya, PLAYER? Actually, we'll skip the chitchat. I'm sure you're much more…
					MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:002_02', false)
					run Sub_Event142(Price=Price)
				case 3:
					# Either I'm seeing things or it's none other than my new favorite cousin! How are ya, PLAYER? Hmm… Weren't you gonna buy some art from me? Let's put a…
					MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:002_03', false)
					run Sub_Event142(Price=Price)
			# Only <90:20:0000> a ticket! Knickknacks, snacks, and drinks to toss back—any and all could be yours! Each ticket nets a prize! You heard that right. …
			MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:003', false)
			if EventFlowSystemActor.GeneralTalkChoice2() == 0:
				run PlayAgain(Price=Price)
			else:
				# Sounds too good to be true, huh? Well, I assure you it IS true. You won't wanna miss out on this!
				MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:004', true)
		case 2:
			run TalkAfterEvent()
		default:
			return

flow FirstTalkFireworks_Setting():
	if EventFlowSystemActor.IsMyVillage():
		if not System.EventFlags['cPlayer:FoxFirstTalkFireworksFlag']:
			System.EventFlags['cPlayer:FoxFirstTalkTodayFireworksFlag'] = true
			System.EventFlags['cPlayer:FoxTalk2020FireworksFlag'] = true
			System.EventFlags['cPlayer:FoxFirstTalkFireworksFlag'] = true
			if System.EventFlags['cPlayer:TunekichiTalkBefore']:
				run Sub_grp_Event76()
			else:
				System.EventFlags['cPlayer:TunekichiTalkBefore'] = true
				System.EventFlags['cPlayer:FoxTalkOnlyStandShopFlag'] = true
				SubflowResults[1] = 1
		elif not System.EventFlags['cPlayer:FoxFirstTalkTodayFireworksFlag']:
			System.EventFlags['cPlayer:FoxFirstTalkTodayFireworksFlag'] = true
			run Sub_grp_Event76()

flow FoodComment():
	switch SubflowResults@3[0]:
		case 1:
			if not System.EventFlags['cPlayer:FoxTalkIceCandyTodayFlag']:
				# Oh! I'm legally obligated to warn you that there are no refunds if you trip and drop that. Watch your step!
				MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:313', false)
				System.EventFlags['cPlayer:FoxTalkIceCandyTodayFlag'] = true
		case 2:
			if not System.EventFlags['cPlayer:FoxTalkTapiocaTodayFlag']:
				# Ah! The fine print. No refunds if you trip and spill that. But come back and try for another if you do!
				MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:327', false)
				System.EventFlags['cPlayer:FoxTalkTapiocaTodayFlag'] = true
		default:
			return

flow PlayAgain(Price: int):
	if not EventFlowSystemActor.HasBellCount(Price):
		# Now that's what I like to— Haaang on a minute! You don't have <90:20:0000>. Sorry, but even though you're like family, if I bend the rules for you, I…
		MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:005', true)
	elif EventFlowSystemActor.SystemHasBaggageSpace('cPocketBag') < 1:
		# Hold on! Your pockets are full. Like I said, EVERY ticket's a winner. You gotta have room for your prize!
		MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:006', true)
	else:
		EventFlowSystemActor.BellCountDown(Price, true)
		System.EventFlags['cLifeSupportAchievement:HowmuchBuyItem'] += 500
		# Excellent! Wonderful! Now, if you please, reach your hand into the box and pull yourself a ticket!
		MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:007', true)
		Player.TurnBody(13, 180.0)
		Player.PlayerWaitTurn()
		Player.PlayerRequestSimple('PlayerDrawLots', true)
		EventFlowSystemActor.WaitFrame(35)
		Player.TurnBody(0, 0.0)
		# What'll it be? What'll you win? Let's find out!<10:7:005a0000>
		MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:008', false)
		if (EventFlowSystemActor.CatalogItemFrom('FoxStand')) and (EventFlowSystemActor.CatalogItemFrom('FoxStandNonExpendable')) and (EventFlowSystemActor.CatalogItemFrom('FoxStandBalloon')) and (EventFlowSystemActor.CatalogItemFrom('FoxFood')):
			switch EventFlowSystemActor.PercentChoice3(40, 10, 50):
				case 0:
					MainNpc.DecideEventReward('cFireWorksFoxExpendable')
				case 1:
					MainNpc.DecideEventReward('cFireWorksFoxNonExpendable')
				case 2:
					if EventFlowSystemActor.PercentChoice(25):
MainNpc.DecideEventReward('cFireWorksFoxBalloon')
					else:
MainNpc.DecideEventReward('cFireWorksFoxFood')
		else:
			MainNpc.DecideEventReward('cFireWorksFox')
		MainNpc.SetItemName(1, 0, 0)
		run PrizeComment()
		EventFlowSystemActor.MessageSuspend()
		MainNpc.SetDeliveryItem(1, false)
		MainNpc.NpcDelivery(1, 'Default')
		MainNpc.SetEventRewardToPlayerBaggage('cFree')
		run FoodComment()
		switch EventFlowSystemActor.RandomChoiceExcludePrevious3(3, true):
			case 0:
				# You're a natural at this! Why don't you pull another? Only <90:20:0000>!
				MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:031', false)
			case 1:
				# You're on a roll. Care to keep it going for another <90:20:0000>?
				MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:032', false)
			case 2:
				# Way to pull that ticket! How'd you like to pull another for <90:20:0000>?
				MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:033', false)
		if EventFlowSystemActor.GeneralTalkChoice2() == 0:
			run PlayAgain(Price=Price)
		else:
			# Ah! Too bad. Come back and play again soon, alright?
			MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:030', true)
			EventFlowSystemActor.UIMoneyDisappear()

flow PrizeComment():
	SubflowResults[0] = 0
	if MainNpc.EventRewardItem(5743):
		# Big number 1!<100:3:cd03> And just like that, you've won yourself a <item>red sparkler! Congratulations!
		MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:010', false)
	elif MainNpc.EventRewardItem(12974):
		# Very nice! It's number 2!<100:3:cd03> Here you go, your very own <item>blue sparkler! Congratulations!
		MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:011', false)
	elif MainNpc.EventRewardItem(13106):
		# One of my favorites, it's number 3!<100:3:cd03> You won yourself a <item>fountain firework! Congratulations!
		MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:012', false)
	elif MainNpc.EventRewardItem(4386):
		# Big score! It's number 4!<100:3:cd03> I've got some <item>bubble blowers with your name on 'em! Congratulations!
		MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:013', false)
	elif MainNpc.EventRewardItem(5319):
		# A nice, round number 5!<100:3:cd03> That'll win you a brand-new <item>uchiwa fan! Congratulations!
		MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:014', false)
	elif MainNpc.EventRewardItem(5744):
		# Is that a 9? No, wait, that's a 6!<100:3:cd03> You won a <item>pinwheel! Congratulations!
		MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:015', false)
	elif MainNpc.EventRewardItem(5742):
		# It's lucky number 7!<100:3:cd03> Here's a <item>tweeter for the big winner! Congratulations!
		MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:016', false)
	elif MainNpc.EventRewardItem(7869):
		# We have a number 8!<100:3:cd03> You've won a <item>blue balloon! Congratulations!
		MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:017', false)
	elif MainNpc.EventRewardItem(13123):
		# It's nuuuuuuuuuumber 9!<100:3:cd03> Enjoy your <item>red balloon! Congratulations!
		MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:018', false)
	elif MainNpc.EventRewardItem(13124):
		# You pulled the number 10!<100:3:cd03> You've won your very own <item>yellow balloon! Congratulations!
		MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:019', false)
	elif MainNpc.EventRewardItem(13125):
		# Heeeeeere's the number 11!<100:3:cd03> And here's a <item>green balloon for the lucky winner! Congratulations!
		MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:020', false)
	elif MainNpc.EventRewardItem(13126):
		# There it is! The number 12!<100:3:cd03> You're the proud owner of a <item>pink balloon! Congratulations!
		MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:021', false)
	elif MainNpc.EventRewardItem(14632):
		# Lucky number 13! Don't let anyone tell you otherwise!<100:3:cd03> You've won a <item>ramune-soda frozen treat! Enjoy!
		MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:310', false)
		SubflowResults[0] = 1
	elif MainNpc.EventRewardItem(14633):
		# Big number 14 it is!<100:3:cd03> And here's your <item>orange frozen treat! Enjoy!
		MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:311', false)
		SubflowResults[0] = 1
	elif MainNpc.EventRewardItem(14631):
		# And we've got the number 15!<100:3:cd03> Chow down on this <item>chocolate frozen treat! Enjoy!
		MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:312', false)
		SubflowResults[0] = 1
	elif MainNpc.EventRewardItem(14629):
		# Why, it's sweet number 16!<100:3:cd03> That'll get you some <item>plain cotton candy! Enjoy!
		MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:318', false)
	elif MainNpc.EventRewardItem(14743):
		# Number 17, in its prime!<100:3:cd03> You've won yourself some <item>melon cotton candy! Enjoy!
		MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:319', false)
	elif MainNpc.EventRewardItem(14744):
		# Looks like it's the number 18!<100:3:cd03> Here's your <item>ramune-soda cotton candy! Enjoy!
		MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:320', false)
	elif MainNpc.EventRewardItem(14748):
		# Number 19!<100:3:cd03> You've won one of my favorites—<item>strawberry cotton candy! Enjoy!
		MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:321', false)
	else:
		if MainNpc.EventRewardItem(14628):
			# It's biiiiiiiiig number 20!<100:3:cd03> That wins you some <item>boba milk tea! Enjoy!
			MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:322', false)
		else:
			if MainNpc.EventRewardItem(14742):
				# How about that! Number 21!<100:3:cd03> I sure hope you like <item>boba coffee! Enjoy!
				MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:323', false)
			elif MainNpc.EventRewardItem(14745):
				# It's number 22! The double deuces!<100:3:cd03> Some <item>boba strawberry tea for the lucky winner! Enjoy!
				MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:324', false)
			elif MainNpc.EventRewardItem(14746):
				# Number 23 sounds great to me!<100:3:cd03> Here's your <item>boba mango tea! Enjoy!
				MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:325', false)
			else:
				# Ah! The number 24! It's like a two- for-one deal on the number 12!<100:3:cd03> Here's your <item>boba green tea! Enjoy!
				MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:326', false)
		SubflowResults[0] = 2

flow PrizeCommentFood():
	if (not System.EventFlags['cPlayer:FoxTalk2020FireworksFlag']) and (not System.EventFlags['cPlayer:FoxTalkFireworksFoodFlag']):
		System.EventFlags['cPlayer:FoxTalkFireworksFoodFlag'] = true
		# And this year I've also brought tasty treats to treat your mouth during the big show!
		MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:300', false)
		switch EventFlowSystemActor.EventCheck('Fireworks'):
			case 0:
				# That's right! Just a raffle ticket away! Don't forget to come back once the fireworks start at 7 and buy a ticket!
				MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:302', false)
			case 1:
				# That's right! And they're just a raffle ticket away! Act fast and act often!
				MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:301', false)
			default:
				return

flow Root():
	run FirstTalkFireworks_Setting()
	switch EventFlowSystemActor.EventCheck('Fireworks'):
		case 0:
			run TalkBeforeEvent()
		case 1:
			switch SubflowResults@4[1]:
				case 0:
					# Welcome! Welcome! You're two steps away from Redd's Raffle! Fabulous prizes! Every ticket's a winner!
					MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:092', false)
				case 1:
					# Welcome! Welcome! You're two steps away from Redd's Raffle! Fabulous prizes! Every ticket's a winner!
					MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:091', false)
					# Oh! Why, I don't believe you and I have had the pleasure. The name's Redd. I work in sales. And you are…<10:4> <50:3>PLAYER! What a great name! Intel…
					MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:002_01', false)
				case 2:
					# Welcome! Welcome! You're two steps away from Redd's Raffle! Fabulous prizes! Every ticket's a winner!
					MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:091', false)
					# Either I'm seeing things or it's none other than my favorite cousin! How are ya, PLAYER? Actually, we'll skip the chitchat. I'm sure you're much more…
					MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:002_02', false)
				case 3:
					# Welcome! Welcome! You're two steps away from Redd's Raffle! Fabulous prizes! Every ticket's a winner!
					MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:091', false)
					# Either I'm seeing things or it's none other than my new favorite cousin! How are ya, PLAYER? Hmm… Weren't you gonna buy some art from me? Let's put a…
					MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:002_03', false)
			run PrizeCommentFood()
			EventFlowSystemActor.MessageSuspend()
		case 2:
			run TalkAfterEvent()
		default:
			return

local flow Sub_Event139():
	run PrizeCommentFood()
	EventFlowSystemActor.MessageSuspend()

local flow Sub_Event142(Price: int):
	run PrizeCommentFood()
	# You're excited, I can tell!
	MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:002_04', false)

local flow Sub_grp_Event76():
	if (not System.EventFlags['cLand:Museum2ConstructionToday']) and (not System.EventFlags['cLand:MuseumGrowupEnable2']) and (not System.EventFlags['cLand:Museum3Built']) and (System.EventFlags['cPlayer:FoxPreVisitWantSellFlag']):
		SubflowResults[1] = 3
	else:
		SubflowResults[1] = 2

flow TalkAfterEvent():
	switch SubflowResults@4[1]:
		case 0:
			if EventFlowSystemActor.FinalFireworksFes():
				# Sorry, Redd's Raffle is closed till next year's fireworks shows. I hope you got as much out of it as I did!
				MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:202', false)
			else:
				# Sorry, we're closed. But don't worry, Redd's Raffle will be back next week. I'll see you then!
				MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:201', false)
		case 1:
			# Sorry, but Redd's Raffle is closed.<10:4> Oh! Why, I don't believe you and I have had the pleasure. The name's Redd. I work in sales. And you are…<10…
			MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:203', true)
		case 2:
			# Sorry, Redd's Raffle is closed.<10:4> Oh! Why, it's my very favorite cousin! How are ya, PLAYER? Actually, I don't have the time to chitchat right no…
			MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:204', true)
		case 3:
			# Sorry, Redd's Raffle is closed.<10:4> Oh! Why, it's my new favorite cousin! How are ya, PLAYER? Hmm… Weren't you gonna buy some art from me? Let's pu…
			MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:205', true)

flow TalkBeforeEvent():
	switch SubflowResults@4[1]:
		case 0:
			# Sorry, Redd's Raffle's not ready yet. I'm still setting up. It'll be open as soon as the fireworks start!
			MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:101', false)
		case 1:
			# Sorry, I'm not open just yet. Oh! Why, I don't believe you and I have had the pleasure. The name's Redd. I work in sales. And you are…<10:4> <50:3>PL…
			MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:102', false)
			run Sub_Event139()
		case 2:
			# Sorry—I'm not open yet.<10:4> Oh! Why, it's none other than my favorite cousin! How are ya, PLAYER? Actually, we'll skip the chitchat. I'm sure you'r…
			MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:103', false)
			run Sub_Event139()
		case 3:
			# Sorry, I'm not open yet.<10:4> Oh! Why, if it isn't my new favorite cousin! How are ya, PLAYER? Hmm… Weren't you gonna buy some art from me? Let's pu…
			MainNpc.OpenMessageWindow('TalkSNpc/fox/GEvent/SP_fox_GEvent_Fireworks:104', false)
			run Sub_Event139()
