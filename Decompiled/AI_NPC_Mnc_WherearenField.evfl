flow Bridge():
    if System.EventFlags['cPlayerTemp:WHEREAREN_MncCheck_Bridge']:
        run AI_NPC_Common::ContinueSpeakrun AI_NPC_Common::ContinueSpeak(FlowName='SNPC_mnc_01_Wherearen', EntryName='Bridge')
 
flow ChkWorkMotionUndo():
    if (System.EventFlags['cPlayerTemp:WHEREAREN_ChocolateDemoReserve']) or (System.EventFlags['cWherearenPlayer:SeqOtgSickOngoing']) or ((not System.EventFlags['cPlayerTemp:WHEREAREN_DocMainEreaFirstTalkDone']) and (System.EventFlags['cWherearenPlayer:TutorialDone']) and (System.EventFlags['cWherearenPlayer:MncMovetoBridge'])):
        MainNpc.NpcDisableServiceMotion()
 
flow Chk_OpDemo():
    if not System.EventFlags['cWherearenPlayer:TutorialDone']:
        if not MainNpc.NpcBlackBoard('OpDemoState', 1):
            MainNpc.NpcDisableServiceMotion()
            MainNpc.NpcChangeTurnDefaultState('cTurn', '', '', '', false, true, true, 1, 45.0, '')
            EventFlowSystemActor.ExitFlowchartEventFlowSystemActor.ExitFlowchart()
        elif not MainNpc.NpcBlackBoard('OpDemoState', 2):
            run AI_NPC_Common::ContinueSpeakrun AI_NPC_Common::ContinueSpeak(EntryName='OpDemo_MncForceTalk', FlowName='Demo_Wherearen_Op')
            EventFlowSystemActor.ExitFlowchartEventFlowSystemActor.ExitFlowchart()
        elif MainNpc.NpcBlackBoard('OpDemoState', 4):
            MainNpc.NpcChangeTurnDefaultState('cTurn', '', 'Demo_Wherearen_Op', 'OpDemo_MncTalkWait', false, true, true, 1, 45.0, '')
            EventFlowSystemActor.ExitFlowchartEventFlowSystemActor.ExitFlowchart()
        else:
            MainNpc.NpcChangeAIState('cMncGoOffice', '', 'Demo_Wherearen_Op', 'OpDemo_MncTalkMove', false, true)
            EventFlowSystemActor.ExitFlowchartEventFlowSystemActor.ExitFlowchart()
 
flow Init():
    run InitOpDemo()
    MainNpc.NpcRegistAIBlackBoard('FirstTalk', 0)
    MainNpc.NpcRegistAIBlackBoard('FirstSharehouseResume', 0)
    MainNpc.NpcAISetting(8, true)
    run InitShareOrder()
    if (not System.EventFlags['cWherearenPlayer:SeqTakeOrderTutorialDone']) and (System.EventFlags['cWherearenPlayer:SeqTakeOrderTutorialOngoing']):
        if EventFlowSystemActor.IsWherearenWorkMode():
            MainNpc.MncWarpTakeOrderPos()
    elif System.EventFlags['cWherearenPlayer:SeqTakeOrderTutorialOngoing']:
        MainNpc.NpcAISetRequestSpeakFunc('cEnterWherearenPier', false)
 
flow InitOpDemo():
    if not System.EventFlags['cWherearenPlayer:TutorialDone']:
        MainNpc.NpcRegistAIBlackBoard('OpDemoState', 0)
        MainNpc.NpcRegistAIBlackBoard('EmoticonIndex', 15)
 
flow InitShareOrder():
    MainNpc.NpcRegistAIBlackBoard('SitDownLookForHouseMate', 0)
    if EventFlowSystemActor.WherearenLookForHousemateState() == 0:
        MainNpc.NpcAISetRequestSpeakFunc('cSitDownMncLookForHouseMate', false)
 
flow Root():
    run Chk_OpDemo()
    run ChkWorkMotionUndo()
    if MainNpc.NpcBlackBoard('FirstTalk', 1):
        MainNpc.NpcSetAIBlackBoard('FirstTalk', 0)
        if EventFlowSystemActor.WherearenOrderStatus() not in (0, 1, 2, 3, 5, 6, 7):
            MainNpc.NpcAISetting(4, false)
        run AI_NPC_Common::ContinueSpeakrun AI_NPC_Common::ContinueSpeak(FlowName='SNPC_mnc_01_Wherearen', EntryName='ForceTalk')
    elif MainNpc.NpcBlackBoard('FirstSharehouseResume', 1):
        MainNpc.NpcSetAIBlackBoard('FirstSharehouseResume', 0)
        run AI_NPC_Common::ContinueSpeakrun AI_NPC_Common::ContinueSpeak(FlowName='SNPC_otg_22_WherearenEvent_ShareHouse', EntryName='Resume_LookForHousemateStart')
    elif System.EventFlags['cPlayerTemp:WHEREAREN_MncTalkReserve_Bridge']:
        if System.EventFlags['cWherearenPlayer:SeqTakeOrderTutorialOngoing']:
            System.EventFlags['cPlayerTemp:WHEREAREN_MncTalkReserve_Bridge'] = false
            run AI_NPC_Common::ContinueSpeakrun AI_NPC_Common::ContinueSpeak(FlowName='SNPC_mnc_11_WherearenEvent_TakeOder', EntryName='Root')
        else:
            if EventFlowSystemActor.WherearenOrderStatus() not in (0, 1, 2, 3, 5, 6, 7):
                MainNpc.NpcAISetting(4, false)
            run AI_NPC_Common::ContinueSpeakrun AI_NPC_Common::ContinueSpeak(FlowName='SNPC_mnc_01_Wherearen', EntryName='ForceTalk')
    elif System.EventFlags['cPlayerTemp:WHREAREN_TakeOrderAfter']:
        MainNpc.NpcChangeTurnDefaultState('cTurn', '', 'SNPC_mnc_01_Wherearen', 'Root', false, true, true, 1, 0.0, '')
    else:
        if System.EventFlags['cPlayerTemp:WHEREAREN_ChocolateDemoReserve']:
            MainNpc.NpcAISetting(3, false)
        switch EventFlowSystemActor.WherearenOrderStatus():
            case 0, 4:
                run AI_NPC_Wherearen_Common::DoOfficerWaitrun AI_NPC_Wherearen_Common::DoOfficerWait(FlowName='SNPC_mnc_01_Wherearen', EntryName='Root')
            case 1:
                switch EventFlowSystemActor.WherearenNpcOrderType():
                    case 0:
                        if System.EventFlags['cWherearenPlayer:SeqOtgSickOngoing']:
                            run Sub_Event43()
                        else:
                            if EventFlowSystemActor.WherearenNpcFreeQuery2('otg', 'cCustomer'):
                                run Sub_Event43()
                            else:
                                run AI_NPC_Wherearen_Common::DoOfficerWaitrun AI_NPC_Wherearen_Common::DoOfficerWait(FlowName='SNPC_mnc_01_Wherearen', EntryName='Root')
                    case 1:
                        switch EventFlowSystemActor.WherearenLookForHousemateState():
                            case 0:
                                MainNpc.NpcDisableServiceMotion()
                                MainNpc.NpcChangeAIState('cWait', '', 'SNPC_mnc_03_WherearenOrder', 'LookforHouseMate', false, true)
                            case 1:
                                if MainNpc.IsOtgOpenFade():
                                    MainNpc.SetNpcSpeakFlow('SNPC_mnc_03_WherearenOrder', 'OpenFadeMatchingTalk')
                                else:
                                    MainNpc.NpcAISetting(4, false)
                                    MainNpc.SetNpcSpeakFlow('SNPC_mnc_03_WherearenOrder', 'OpenSceneMatchingTalk')
                                MainNpc.NpcDisableServiceMotion()
                                MainNpc.NpcChangeAIState('cOtgStandby', '', '', '', false, true)
                            case 2:
                                if MainNpc.IsOtgOpenFade():
                                    MainNpc.SetNpcSpeakFlow('SNPC_mnc_03_WherearenOrder', 'OpenFadeOrder')
                                else:
                                    MainNpc.NpcAISetting(4, false)
                                    MainNpc.SetNpcSpeakFlow('SNPC_mnc_03_WherearenOrder', 'OrderTalk')
                                MainNpc.NpcDisableServiceMotion()
                                MainNpc.NpcChangeAIState('cOtgStandby', '', '', '', false, true)
                    case 2:
                        run AI_NPC_Wherearen_Common::DoOfficerWaitrun AI_NPC_Wherearen_Common::DoOfficerWait(FlowName='SNPC_mnc_01_Wherearen', EntryName='Root')
                    case 3:
                        if EventFlowSystemActor.WherearenNpcFreeQuery2('otg', 'cCustomer'):
                            run Sub_Event43()
                        else:
                            run AI_NPC_Wherearen_Common::DoOfficerWaitrun AI_NPC_Wherearen_Common::DoOfficerWait(FlowName='SNPC_mnc_01_Wherearen', EntryName='Root')
            default:
                return
 
local flow Sub_Event43():
    MainNpc.NpcAISetting(4, false)
    if MainNpc.IsOtgOpenFade():
        MainNpc.SetNpcSpeakFlow('SNPC_otg_02_WherearenOrder', 'Root')
    else:
        MainNpc.SetNpcSpeakFlow('SNPC_otg_02_WherearenOrder', 'NotFade')
    MainNpc.NpcDisableServiceMotion()
    MainNpc.NpcChangeAIState('cOtgStandby', '', '', '', false, true)
 
