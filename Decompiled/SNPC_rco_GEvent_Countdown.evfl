flow Rco_Common_Buy():
    if SubflowResults@2[2] == 0:
        if EventFlowSystemActor.HasBellCount(500):
            run Sub_Event15()
        else:
            run Rco_Common_NoMoney()
    else:
        if EventFlowSystemActor.HasBellCount(300):
            run Sub_Event15()
        else:
            run Rco_Common_NoMoney()
 
flow Rco_Common_Cancel():
    # No? Hm, well, if the party mood hits and you want to buy something later, come see me!
    MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:004', true)
    EventFlowSystemActor.ExitFlowchartEventFlowSystemActor.ExitFlowchart()
 
flow Rco_Common_DemoBuy():
    MainNpc.SetDeliveryItem(1, true)
    if SubflowResults@2[2] == 0:
        EventFlowSystemActor.BellCountDown(500, true)
    else:
        EventFlowSystemActor.BellCountDown(300, true)
 
flow Rco_Common_ItemFull_Buy():
    # Thank you for… Hold on… Did you know that your pockets are full? Hm? No problem, though! Come see me when you get your things organized.
    MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:006', true)
    EventFlowSystemActor.ExitFlowchartEventFlowSystemActor.ExitFlowchart()
 
flow Rco_Common_ItemFull_Get():
    # Oh dear…I can't give you a present when your pockets are full. Stop by to get it later, OK?
    MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:106', false)
    EventFlowSystemActor.ExitFlowchartEventFlowSystemActor.ExitFlowchart()
 
flow Rco_Common_NoMoney():
    # Thank you for… One moment… You do realize you're lacking the funds for this purchase, hm? No worries, though! Just come and see me when you have the …
    MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:005', true)
    EventFlowSystemActor.ExitFlowchartEventFlowSystemActor.ExitFlowchart()
 
flow Rco_Cracker_Get():
    if SubflowResults@2[0] != 0:
        if EventFlowSystemActor.IsMyVillage():
            # <50:3>PLAYER! Here's the gift I couldn't give you earlier.
            MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:107', false)
        else:
            # Hello! Here's the gift I couldn't give you earlier.
            MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:114', false)
    MainNpc.MessageSuspend()
    MainNpc.SetDeliveryItem(1, true)
    MainNpc.NpcDelivery(1, 'Keep')
    if EventFlowSystemActor.EnvHourCompare(0, -1, true, true) == 0:
        # Those are <item>party poppers! I have no doubt they'll bring some fun and excitement to the Countdown!
        MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:103', false)
    else:
        # Those are <item>party poppers! The new year is already here, but we can still have some Countdown fun!
        MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:104', false)
    MainNpc.NpcDelivery(2, '"Default"')
    if EventFlowSystemActor.IsMyVillage():
        # This event only happens once a year, so make the best of it!
        MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:105', false)
        System.EventFlags['cPlayer:SzaGotCracker'] = true
    else:
        # You be sure to enjoy your time on ISLAND today, hm?
        MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:115', false)
        System.EventFlags['cPlayerVisit:VisitorGotCracker'] = true
    EventFlowSystemActor.ExitFlowchartEventFlowSystemActor.ExitFlowchart()
 
flow Rco_Get_Cracker_Chk():
    EventFlowSystemActor.SelectRewardItemDirect(2753, 5, 'cVillageRemakePattern', 0)
    if EventFlowSystemActor.ShoppingCapacity('cReward', 2753):
        if SubflowResults@2[1] == 0:
            run Rco_Cracker_Get()
        else:
            SubflowResults[2] = 1
            run Rco_Common_Buy()
 
flow Rco_Select_Buy():
    EventFlowSystemActor.UIMoneyAppear()
    if EventFlowSystemActor.EnvHourCompare(0, -1, true, true) == 0:
        # Welcome, welcome! Need any party goods to spice up your Countdown?
        MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:001', false)
    else:
        # Happy New Year! Can I interest you in some party goods to kick off the new year?
        MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:002', false)
    EventFlowSystemActor.SetTagFromSystem('cFlow', 'cMoney', 0, 500, '')
    EventFlowSystemActor.SetTagFromSystem('cFlow', 'cMoney', 1, 300, '')
    # It's <90:20:0000> for a <item>New Year's hat, and today only it's <90:20:0001> for a five-pack of <item>party poppers!
    MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:003', false)
    switch EventFlowSystemActor.GeneralTalkChoice3():
        case 0:
            MainNpc.CountdownRctManualChoice()
            # What color of <item>New Year's hat would you like?
            MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:009', false)
            switch EventFlowSystemActor.GeneralTalkChoice5():
                case 0:
                    MainNpc.RctSetNewYearHat(0)
                    run Sub_grp_Event27()
                case 1:
                    MainNpc.RctSetNewYearHat(1)
                    run Sub_grp_Event27()
                case 2:
                    MainNpc.RctSetNewYearHat(2)
                    run Sub_grp_Event27()
                case 3:
                    MainNpc.RctSetNewYearHat(3)
                    run Sub_grp_Event27()
                case 4:
                    run Rco_Common_Cancel()
        case 1:
            SubflowResults[1] = 1
            run Rco_Get_Cracker_Chk()
            run Rco_Common_ItemFull_Buy()
        case 2:
            run Rco_Common_Cancel()
 
flow Root():
    if EventFlowSystemActor.EnvHourCompare(0, -1, true, true) == 0:
        if EventFlowSystemActor.EnvHourCompare(23, 59, true, true) != 0:
            # The new year is almost here!<10:7:001e0000>
            MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:010', false)
        elif EventFlowSystemActor.IsMyVillage():
            if not System.EventFlags['cPlayer:RcoTalkBeforeCountdown']:
                System.EventFlags['cPlayer:RcoTalkBeforeCountdown'] = true
                # Ah, PLAYER! Hello, hello! I'm helping everyone gear up for the Countdown event today! I've got some nifty party goods for ringing in the new year, so…
                MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:100', false)
                # Oh! That reminds me! I also have some Countdown-related gifts.
                MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:102', false)
                SubflowResults[0] = 0
                SubflowResults[1] = 0
                run Rco_Get_Cracker_Chk()
                run Rco_Common_ItemFull_Get()
            elif System.EventFlags['cPlayer:SzaGotCracker']:
                run Rco_Select_Buy()
            else:
                SubflowResults[0] = 1
                SubflowResults[1] = 0
                run Rco_Get_Cracker_Chk()
                run Rco_Select_Buy()
        elif not System.EventFlags['cPlayerVisit:RcoVisitorTalkBeforeCountdown']:
            System.EventFlags['cPlayerVisit:RcoVisitorTalkBeforeCountdown'] = true
            # Hello, hello! And welcome to ISLAND! Today's the day of our big Countdown event. I'm selling party goods to help liven things up, so look them over w…
            MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:111', false)
            # Oh! I also have gifts for folks who are participating in the Countdown on ISLAND. You'll love 'em!
            MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:113', false)
            SubflowResults[0] = 0
            SubflowResults[1] = 0
            run Rco_Get_Cracker_Chk()
            run Rco_Common_ItemFull_Get()
        elif System.EventFlags['cPlayerVisit:VisitorGotCracker']:
            run Rco_Select_Buy()
        else:
            SubflowResults[0] = 1
            SubflowResults[1] = 0
            run Rco_Get_Cracker_Chk()
            run Rco_Select_Buy()
    elif EventFlowSystemActor.IsMyVillage():
        if not System.EventFlags['cPlayer:RcoTalkAfterCountdown']:
            System.EventFlags['cPlayer:RcoTalkAfterCountdown'] = true
            # Alright then, PLAYER! Happy New Year!<10:4> Here's to another good one, yes, yes!
            MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:108', false)
            if not System.EventFlags['cPlayer:RcoTalkBeforeCountdown']:
                # We're celebrating a brand-new year, and I'm doing my part to help folks start it off with style! I've got all sorts of party goods on hand, so take a…
                MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:101', false)
                # Oh! That reminds me! I also have some Countdown-related gifts.
                MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:102', false)
                SubflowResults[1] = 0
                run Rco_Get_Cracker_Chk()
                run Rco_Common_ItemFull_Get()
        elif System.EventFlags['cPlayer:SzaGotCracker']:
            run Rco_Select_Buy()
        else:
            SubflowResults[0] = 1
            SubflowResults[1] = 0
            run Rco_Get_Cracker_Chk()
            run Rco_Select_Buy()
    elif not System.EventFlags['cPlayerVisit:RcoVisitorTalkAfterCountdown']:
        System.EventFlags['cPlayerVisit:RcoVisitorTalkAfterCountdown'] = true
        # Happy New Year!<10:4> I do hope you'll put ISLAND on your travel list this year too!
        MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:116', false)
        if not System.EventFlags['cPlayer:RcoTalkBeforeCountdown']:
            # We've been celebrating the big Countdown event! The party goods I'm selling can help liven up your New Year too, so take a look when you have a momen…
            MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:112', false)
            # Oh! I also have gifts for folks who are participating in the Countdown on ISLAND. You'll love 'em!
            MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:113', false)
            SubflowResults[0] = 0
            SubflowResults[1] = 0
            run Rco_Get_Cracker_Chk()
            run Rco_Common_ItemFull_Get()
    elif System.EventFlags['cPlayerVisit:VisitorGotCracker']:
        run Rco_Select_Buy()
    else:
        SubflowResults[0] = 1
        SubflowResults[1] = 0
        run Rco_Get_Cracker_Chk()
        run Rco_Select_Buy()
 
local flow Sub_Event15():
    # Thank you!
    MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:007', false)
    run Demo_Common::Demo_Rco_Countdown_Shoppingrun Demo_Common::Demo_Rco_Countdown_Shopping()
    # Always a pleasure!
    MainNpc.OpenMessageWindow('TalkSNpc/rco/GEvent/SP_rco_GEvent_Countdown:008', true)
    if SubflowResults@2[2] == 0:
        EventFlowSystemActor.PlayReport('cCountdownBuyHat', 500)
        System.EventFlags['cLifeSupportAchievement:HowmuchBuyItem'] += 500
    else:
        EventFlowSystemActor.PlayReport('cCountdownBuyCracker', 300)
        System.EventFlags['cLifeSupportAchievement:HowmuchBuyItem'] += 300
    EventFlowSystemActor.ExitFlowchartEventFlowSystemActor.ExitFlowchart()
 
local flow Sub_grp_Event27():
    if EventFlowSystemActor.SystemHasBaggageSpace('cPocketBag') < 1:
        run Rco_Common_ItemFull_Buy()
    else:
        run Rco_Common_Buy()
 
