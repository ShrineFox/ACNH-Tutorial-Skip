flow CheckChoco():
	SubflowResults[2] = 1
	run PreCheck()
	if not System.EventFlags['cWherearenPlayer:SeqManTalkAboutChocolate']:
		System.EventFlags['cWherearenPlayer:SeqManTalkAboutChocolate'] = true
		# Those<150:5>are <item>souvenir chocolates. They are sweet. And yummy. A truly great gift<150:5>
		MainNpc.OpenMessageWindow('TalkSNpc/man/SP_man_WherearenOffice:007', true)
	run PreProcess()
	EventFlowSystemActor.SetTagFromUIResult('cWherearenItem3Price', 1)
	# A box of <item>souvenir chocolates costs <90:44:0000>…but I can get a discount if I buy several at once.
	MainNpc.OpenMessageWindow('TalkSys/SYS_Wherearen_OfficeShop:005', false)
	switch EventFlowSystemActor.GeneralTalkChoice3():
		case 0:
entrypoint Event37:
			if not EventFlowSystemActor.ShoppingCapacity('cWherearenItem', 65534):
				run Sub_Event43()
			elif MainNpc.ShopHasBellCount(1.0):
				MainNpc.ShopBuyDone(false, false, false, false)
				run Sub_Event15()
			else:
				run Sub_Event42()
		case 1:
			if not EventFlowSystemActor.ShoppingCapacity('cWherearenItem3', 65534):
				run Sub_Event43()
			elif MainNpc.ShopHasBellCount(3.0):
				MainNpc.ShopBuyDone(false, false, false, true)
				run Sub_Event15()
			else:
				run Sub_Event42()
		case 2:
			# Maybe some other time…
			MainNpc.OpenMessageWindow('TalkSys/SYS_Wherearen_OfficeShop:002', true)

flow PreCheck():
	if System.EventFlags['cWherearenPlayer:ManGenerateInFieldTemp']:
		# I don't see Wardell around. I'll shop some other time.
		MainNpc.OpenMessageWindow('TalkSys/SYS_Wherearen_OfficeShop:103', true)
		EventFlowSystemActor.ExitFlowchart()
	elif not System.EventFlags['cWherearenPlayer:OtgGetStartingSalary']:
		# Lottie is waiting for me. I'll shop some other time.
		MainNpc.OpenMessageWindow('TalkSys/SYS_Wherearen_OfficeShop:101', true)
		EventFlowSystemActor.ExitFlowchart()

flow PreProcess():
	MainNpc.ShopCheckItemSet('CheckItemIndex', 'cWherearenOffice')
	EventFlowSystemActor.SetTagFromUIResult('cItemName', 0)
	EventFlowSystemActor.SetTagFromUIResult('cWherearenItemPrice', 0)
	MainNpc.TurnNeck(10, false)
	Player.TurnNeck(13, false)

flow Root():
	SubflowResults[2] = 0
	run PreCheck()
	run SNPC_man_01_WherearenOffice::DeferredPaymentChk()
	if SubflowResults@2[1] != 0:
		System.EventFlags['cWherearenPlayer:Unlock_ManDeferredPayment'] = true
		# <50:3>PLAYER<150:5>I have news. We've started<150:5>a new service. Employees of Paradise Planning<150:5> can pay for their purchases later<150:5> if …
		MainNpc.OpenMessageWindow('TalkSNpc/man/SP_man_WherearenOffice:009', true)
	run PreProcess()
	# It says it costs <90:44:0000> for [a|an]<125:0:0000>.
	MainNpc.OpenMessageWindow('TalkSys/SYS_Wherearen_OfficeShop:001', false)
	if EventFlowSystemActor.GeneralTalkChoice2() == 0:
		run Event37()
	else:
		# Maybe some other time…
		MainNpc.OpenMessageWindow('TalkSys/SYS_Wherearen_OfficeShop:002', true)

flow SetTalkCamera():
	EventFlowSystemActor.StoreNormalCamera(false, '')
	EventFlowSystemActor.WaitFrame(25)

local flow Sub_Event15():
	EventFlowSystemActor.MessageSuspend()
	run SetTalkCamera()
	MainNpc.NpcSetAIBlackBoard('IsNodding', 1)
	run Sub_Event35()

local flow Sub_Event35():
	run SNPC_man_01_WherearenOffice::ManCatalogChk()
	if SubflowResults@2[0] == 1:
		MainNpc.NpcSetAIBlackBoard('IsNodding', 0)
		System.EventFlags['cPlayer:OtgTipsExplainManCatalog'] = true
		System.EventFlags['cWherearenPlayer:SeqManTalkAboutCatalogShop'] = true
		# Hello<150:5>PLAYER. I really appreciate your business<150:5> You're one of our best customers. Just let me know<150:5>if you ever want to place a spe…
		MainNpc.OpenMessageWindow('TalkSNpc/man/SP_man_WherearenOffice:008', true)

local flow Sub_Event42():
	# …Uh-oh! I don't have enough on me.
	MainNpc.OpenMessageWindow('TalkSys/SYS_Wherearen_OfficeShop:003', true)
	if (SubflowResults@2[2] == 0) and (System.EventFlags['cWherearenPlayer:Unlock_ManDeferredPayment']) and (not EventFlowSystemActor.WherearenShopLoan()):
		run SetTalkCamera()
		# You can pay later<150:5>since you only have one item. Do you want to make the purchase?
		MainNpc.OpenMessageWindow('TalkSNpc/man/SP_man_WherearenOffice:004', false)
		if EventFlowSystemActor.GeneralTalkChoice2() == 0:
			MainNpc.ShopBuyDone(false, false, true, false)
			# OK! Please be sure to pay<150:5>at another time, please.
			MainNpc.OpenMessageWindow('TalkSNpc/man/SP_man_WherearenOffice:010', false)
			run Sub_Event35()
		else:
			# <150:5>OK.
			MainNpc.OpenMessageWindow('TalkSNpc/man/SP_man_WherearenOffice:012', true)

local flow Sub_Event43():
	# …Hang on. My pockets are full, so I can't carry anything else right now.
	MainNpc.OpenMessageWindow('TalkSys/SYS_Wherearen_OfficeShop:004', true)
	run SetTalkCamera()
	# Your pockets<150:5>are very full. You can store items in the cabinet<150:5>on the second floor. If you want.
	MainNpc.OpenMessageWindow('TalkSNpc/man/SP_man_WherearenOffice:005', true)
