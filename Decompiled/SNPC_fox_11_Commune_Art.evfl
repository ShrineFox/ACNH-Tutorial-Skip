flow CheckItemSet():
	MainNpc.ShopCheckItemSet('CheckItemIndex', 'cCommuneIslandGallery')
	EventFlowSystemActor.SetTagFromUIResult('cItemName', 0)
	EventFlowSystemActor.SetTagFromUIResult('cFoxPrice', 0)

flow LookArtMode():
	EventFlowSystemActor.UIMoneyDisappear()
	EventFlowSystemActor.MessageSuspend()
	EventFlowSystemActor.RunCheckArtCamera()
	EventFlowSystemActor.HoldGalleryCamera()
	EventFlowSystemActor.UIMoneyAppear()

flow Main():
	if MainNpc.FoxIsSoldOut():
		if MainNpc.FoxCheckItemBuyPlayer():
			# Don't worry, we'll get that shipped out to you as quick as we can. I'm even gonna skip shipping insurance. All the paperwork just slows things down, …
			MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_04_Art:014', false)
			run Sub_grp_Event58()
		else:
			EventFlowSystemActor.SetTagFromSystem('cCommuneFoxGalleryBuyPlayerName', 'cDegit', 0, 0, '')
			# You're too late. <50:3><115:0:cd00> from <110:34> bought that <125:0:0000>. They've got quite the eye for art, if I may say so. Speakin' of eyes, wan…
			MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_04_Art:015', false)
			run Sub_grp_Event58()
	elif System.EventFlags['cPlayer:FoxCommuneBuyArtTodayFlag']:
		# It's really hard to resist that <125:0:0000>, isn't it? But store policy is one art purchase per customer per day. You can look all you want though!
		MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_04_Art:016', false)
		run Sub_grp_Event58()
	elif System.EventFlags['cPlayer:FoxBuyArtTodayFlag']:
		# It's just amazing how easily that <125:0:0000> draws the eye, isn't it? But our policy is one art purchase per customer per day, even if you bought a…
		MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_04_Art:017', false)
		run Sub_grp_Event58()
	else:
		EventFlowSystemActor.UIMoneyAppear()
		if MainNpc.FoxItemCheck():
			# Can't get that one out of your mind? I know just what that's like. But I say why get it out of your mind at all? My offer's still good, y'know. For o…
			MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_04_Art:005', false)
		else:
			MainNpc.FoxItemCheck()
			if System.EventFlags['cPlayerTemp:FoxCheckArtCount'] < 1:
				if System.EventFlags['cPlayer:FoxCommuneTalkBeforeFlag']:
					# Wanna buy maybe the finest piece I've ever had in stock? Well, this <125:0:0000> is it. I could charge you what it's worth, but I'm not gonna do that…
					MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_04_Art:006', false)
				else:
					# I won't lie. An awful lot of folks have been asking me about buyin' that <125:0:0000> there. But maybe the price scared 'em off, so…I'll sell it to y…
					MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_04_Art:001', false)
			else:
				switch EventFlowSystemActor.RandomChoice3(3):
					case 0:
						# Y'know, I catch myself staring at that <125:0:0000> a lot. Honestly, I just wish someone would buy it so I could get more work done. I shouldn't…but …
						MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_04_Art:003', false)
					case 1:
						# So you think you want <50:1> <125:0:0000>, huh? Believe it or not, that's actually my favorite piece here. I really don't wanna sell it, but…it's you…
						MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_04_Art:004', false)
					case 2:
						# Wow, you really know your art. You can just FEEL the aura on that <125:0:0000>, huh? I mean, you couldn't buy that kind of aura! Well, YOU could. And…
						MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_04_Art:002', false)
			System.EventFlags['cPlayerTemp:FoxCheckArtCount'] += 1
		switch EventFlowSystemActor.GeneralTalkChoice3():
			case 0:
				run Sub_grp_Event30()
			case 1:
				run LookArtMode()
				# Admiring the detail? Can't blame you. It's extremely…detailed. Brilliant stuff. And the best part? All that detail could be yours for just <90:21:000…
				MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_04_Art:007', false)
				if EventFlowSystemActor.GeneralTalkChoice2() == 0:
					run Sub_grp_Event30()
				else:
					# I understand, I understand. It's a lot to take in all at once. No rush.
					MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_04_Art:008', false)
			case 2:
				# I get it—it's a big decision. Take your time and look around some more. I'll be here.
				MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_04_Art:009', false)

flow Root():
	EventFlowSystemActor.CommuneTrailerSetCulling('skk', 'cON')
	SubflowResults[0] = 1
	run SNPC_fox_11_Commune::CommonTalk()
	run CheckItemSet()
	run Main()
	EventFlowSystemActor.UIMoneyDisappear()
	EventFlowSystemActor.CommuneTrailerSetCulling('skk', 'cOFF')
	EventFlowSystemActor.StoreNormalCamera(false, '')

local flow Sub_grp_Event30():
	if MainNpc.ShopHasBellCount(1.0):
		# Ha! You are NOT gonna regret this. I'll just take those Bells from you…
		MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_04_Art:011', false)
		MainNpc.ShopBuyDone(false, false, false, false)
		EventFlowSystemActor.WaitFrame(20)
		MainNpc.FoxSoldOutTagVisible()
		EventFlowSystemActor.WaitFrame(20)
		# Yep, it's all there. Congratulations! You are now the proud owner of [a|an]<125:0:0000>!
		MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_04_Art:012', false)
		# Been a pleasure doin' business with you, cousin! I'll get your art packed up and shipped out tomorrow.
		MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_04_Art:013', false)
		MainNpc.FoxSetBuyItem()
		System.EventFlags['cLand:FoxCommuneArtStockCount'] += 1
		System.EventFlags['cPlayer:FoxBuyArtTodayFlag'] = true
		System.EventFlags['cPlayer:FoxCommuneBuyArtTodayFlag'] = true
		System.EventFlags['cLifeSupportAchievement:BuyatTsunekichiShop'] += 1
	else:
		# But…you don't have enough Bells. Look, I love hagglin', but I still gotta keep my shop afloat, y'know?
		MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_04_Art:010', false)

local flow Sub_grp_Event58():
	if EventFlowSystemActor.GeneralTalkChoice2() == 0:
		run LookArtMode()
		# One glance and suddenly it's like you've known the artist for years. Gonna be sad to see this one go.
		MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_04_Art:018', false)
	else:
		# No problem at all! Please take a look at the rest of our stock, and let me know if you have any questions.
		MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_04_Art:019', false)
