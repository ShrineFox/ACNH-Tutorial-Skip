flow Root():
    if not System.EventFlags['cPlayer:BirthdayPCandleFlag']:
        switch EventFlowSystemActor.RandomChoiceExcludePrevious3(3, true):
            case 0:
                # Come on, <110:4>! The candles will melt if you don't hurry. Go on, hit !
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:100', true)
            case 1:
                # It's easy. Just take a deep breath, hit , and blow!<10:4> Hurry! It's a fire hazard!
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:101', true)
            case 2:
                # Alright, do it in one blow with ! Don't worry—you're gonna nail it.
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:102', true)
    elif System.EventFlags['cLandTemp:PlayerBirthdayPinataEnd']:
        switch EventFlowSystemActor.RandomChoiceExcludePrevious5(5, true):
            case 0:
                # Ya know what I think? Birthday cake tastes better than everyday cake.
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:103', true)
            case 1:
                # Birthdays are so mysterious, aren't they? I mean…it's always SOMEONE'S birthday… The world is, like, in permanent birthday mode. Crazy…
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:104', true)
            case 2:
                # That piñata was hard work to make. The first one? Broke on its own. The second one was empty… The third one… It's better not to talk about the THIRD …
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:105', true)
            case 3:
                # Happy birthday! <50:3><110:29>!
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:106', true)
            case 4:
                # Did your birthday cake taste good?<10:4> Whew! After what happened in the kitchen, I was worried.
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:107', true)
    else:
        run Root_7_Cupcake_1()
 
flow Root_1_Field(TargetX: float = 0.0, TargetZ: float = 0.0, MiddleTargetX: float = 0.0, MiddleTargetZ: float = 0.0):
    switch EventFlowSystemActor.RandomChoice3(3):
        case 0:
            # Hey there, <110:4>! Come with me. No time for questions! Only following!
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:001', true)
        case 1:
            # Hey, <110:4>. I've been looking for you.<10:4> Follow me! Ow. I think I pulled something doing that…
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:002', true)
        case 2:
            # Hey, <110:4>. I've been waiting for you. Come with me…and don't ask why!
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:003', true)
    MainNpc.EventFlags['cNpcTemp:PlayerBirthdayCall'] = false
    EventFlowSystemActor.FadeOut('cCircle', 'cCircle', 'cBlack', 1.0, 1.0, true)
    MainNpc.WarpPlayerBirthdayHouse(TargetX, TargetZ, MiddleTargetX, MiddleTargetZ)
    EventFlowSystemActor.RequestRecreateFtr()
    EventFlowSystemActor.WaitFrame(30)
    EventFlowSystemActor.FadeIn(true)
    EventFlowSystemActor.PlayerBirthdayStopOriginalBGM()
    MainNpc.CloseUmbrella()
    fork:
        branch:
            MainNpc.NpcEnterDoor(true)
            MainNpc.ChangeNpcPlace('cTalkNpcHouse')
            EventFlowSystemActor.WaitFrame(50)
            EventFlowSystemActor.SystemRequestChangeStage('cTalkNpcHouse', 'cCircle', 'cCircle', 'cBlack', 1.0, 1.0)
        branch:
            EventFlowSystemActor.WaitFrame(50)
            Player.PlayerMoveToTarget(false, TargetX, TargetZ, 0.0, 0.0, true, 'cNoDoorIn')
 
flow Root_2_In():
    EventFlowSystemActor.SoundDuckingOn(21)
    EventFlowSystemActor.PlayerBirthdayStartBGM()
    EventFlowSystemActor.CameraSetDemoParam('cTalk', 'cTalk', 'cPlayer', false, false, false, 0)
    fork:
        branch:
            MainNpc.SetNpcFeel('cHappy', 3000, false)
        branch:
            Npc_1.SetNpcFeel('cHappy', 3000, false)
        branch:
            Npc_2.SetNpcFeel('cHappy', 3000, false)
    MainNpc.NpcChangeNameStatus(2)
    fork:
        branch:
            MainNpc.CharacterEmoticonAction('Cheering', false, '', 0, false)
            # <10:12>HAPPY BIRTHDAAAY!
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:005', true)
        branch:
            Npc_1.CharacterEmoticonAction('Cheering', false, '', 0, false)
        branch:
            Npc_2.CharacterEmoticonAction('Cheering', false, '', 0, false)
    fork:
        branch:
            MainNpc.CharacterEmoticonAction('FaintSmile', false, '', 0, false)
        branch:
            Npc_1.CharacterEmoticonAction('FaintSmile', false, '', 0, false)
        branch:
            Npc_2.CharacterEmoticonAction('FaintSmile', false, '', 0, false)
    Player.PlayerMoveToTarget(false, 160.0, 185.0, 0.0, 0.0, true, 'cDemoTalk')
    Player.TurnBody(0, 0.0)
    MainNpc.NpcChangeNameStatus(0)
    fork:
        branch:
            MainNpc.TurnBody(10, 0.0)
            switch EventFlowSystemActor.PlayerBirthdayIsSpecialDay():
                case 0, 3, 4, 5, 6:
                    # We've been waiting because… We wanna celebrate your birthday with you, <110:4>! OK, now hit  to blow out the candles!
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:006', true)
                case 1:
                    # We're all here to celebrate your birthday, <110:4>. The party's a little early since it's not a leap year, but I hope you still dig it. Come on! Hit …
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:007', true)
                case 2:
                    # <50:3><110:4>, it's your birthday, and we've been waiting to celebrate with you. I'm so glad it's a leap year! We get to celebrate right on February …
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:008', true)
            MainNpc.EventFlags['cNpcMemory:BirhdayPTalkFlag'] = true
        branch:
            Npc_1.TurnBody(10, 0.0)
            Npc_1.CharacterEmoticonAction('Clapping', false, '', 0, false)
            Npc_1.EventFlags['cNpcMemory:BirhdayPTalkFlag'] = true
        branch:
            Npc_2.TurnBody(10, 0.0)
            Npc_2.CharacterEmoticonAction('Clapping', false, '', 0, false)
            Npc_2.EventFlags['cNpcMemory:BirhdayPTalkFlag'] = true
    EventFlowSystemActor.WaitFrame(5)
    fork:
        branch:
            EventFlowSystemActor.WaitFrame(5)
            MainNpc.EquipCracker()
        branch:
            EventFlowSystemActor@sub1.WaitFrame(10)
            Npc_1.EquipCracker()
        branch:
            EventFlowSystemActor@sub2.WaitFrame(13)
            Npc_2.EquipCracker()
    EventFlowSystemActor.WaitFrame(10)
    EventFlowSystemActor.FadeOut('cNormalFader', 'cNormalFader', 'cBlack', 0.5, 1.0, false)
    MainNpc.PlayerBirthdayWarpNpcForCandleBlow()
    EventFlowSystemActor.BirthdaySwitchLight(0)
    EventFlowSystemActor.BirthdaySwitchCurtain(0)
    Player.PlayerBirthdayForbidStartUI(0)
 
flow Root_3_Stop():
    switch EventFlowSystemActor.RandomChoiceExcludePrevious3(3, true):
        case 0:
            # <50:3><110:4>? Where ya going? We made this cake just for you.
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:009', true)
        case 1:
            # Hold up, <110:4>! Come back! Blow the candles out before they, like, melt.
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:010', true)
        case 2:
            # Where ya going? You oughta blow out the candles before ya leave.<10:4> Total fire hazard.
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:011', true)
    Player.PlayerDemoMove('cNextInfoAngle', 3)
 
flow Root_4_Main():
    Player.PlayerBirthdayTurnBodyToTable()
    Player.PlayerCandleBlow()
    Player.TurnNeck(11, false)
    EventFlowSystemActor.WaitFrame(10)
    fork:
        branch:
            MainNpc.UseCracker()
            MainNpc.CharacterEmoticonAction('Clapping', true, '', 0, false)
        branch:
            Npc_1.UseCracker()
            Npc_1.CharacterEmoticonAction('Clapping', true, '', 0, false)
        branch:
            Npc_2.UseCracker()
            Npc_2.CharacterEmoticonAction('Clapping', true, '', 0, false)
    EventFlowSystemActor.WaitFrame(40)
    fork:
        branch:
            MainNpc.SetNpcFeel('cNormal', 120, false)
        branch:
            Npc_1.SetNpcFeel('cNormal', 120, false)
        branch:
            Npc_2.SetNpcFeel('cNormal', 120, false)
    System.EventFlags['cPlayer:BirthdayPCandleFlag'] = true
    EventFlowSystemActor.WaitFrame(10)
    EventFlowSystemActor.SoundTriggerEmit('LightOn', -1)
    EventFlowSystemActor.BirthdaySwitchLight(1)
    EventFlowSystemActor.WaitFrame(45)
    MainNpc.EventFlags['cNpcTemp:PlayerBirthdayPresent'] = true
    Player.SetDemoTalkTurnRate(0.10000000149011612)
    Player.PlayerBirthdayForbidStartUI(0)
 
flow Root_5_Present():
    # Happy birthday, <110:4>! You blew them out in one go. Now it's time for us to give you our presents!
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:013', false)
    fork:
        branch:
            # We brainstormed it together! I hope ya dig it! Um, I didn't brainstorm. It sounded kinda scary.
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:014', false)
            MainNpc.DecideEventReward('cPlayerBirthdayPresent')
            MainNpc.SetDeliveryItem(1, true)
            if EventFlowSystemActor.ShoppingCapacity('cReward', 65534):
                # A huh huh huh! Here ya go!
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:017', true)
                MainNpc.WrapDeliveryItem('cPresentBox')
                MainNpc.NpcDelivery(1, 'Default')
                MainNpc.AddMemoryEventPlayerForNpc('Present_FromNNPC')
                MainNpc.SetBirthdayPresentFlag()
                Player.CharacterEmoticonAction('Smiling', false, '', 0, false)
                # What's in it? A surprise! Open it later when you have time. A huh huh huh, actually… We do have ONE more present for you today! I'll go get it ready.…
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:018', true)
            else:
                System.EventFlags['cPlayer:BirthdayPNotPresentFlag'] = true
                MainNpc.NpcMailSendRandom('MAIL_XX_BirthDayP', 1, 3, 'cNone', 'cFastToday', 'cReward', false)
                MainNpc.SetBirthdayPresentFlag()
                # Uh-oh. Looks like your pockets are too full to fit my present. No worries. I'll deliver it to your house later. A huh huh huh, actually… I've got ONE…
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:019', true)
            EventFlowSystemActor.SoundDuckingOn(33)
            EventFlowSystemActor.FadeOut('cCircle', 'cCircle', 'cBlack', 1.0, 1.0, false)
        branch:
            Npc_1.CharacterEmoticonAction('Smiling', false, '', 0, false)
        branch:
            Npc_2.CharacterEmoticonAction('Smiling', false, '', 0, false)
    MainNpc.EventFlags['cNpcTemp:PlayerBirthdayRestoreCamera'] = 1
    MainNpc.Pinata(0)
    EventFlowSystemActor.BirthdaySwitchCurtain(2)
    Player.SetDemoTalkTurnRate(0.3199999928474426)
 
flow Root_6_Pinata_1():
    EventFlowSystemActor.CameraSetDemoParam('cPlayerBDPinataExplain', '', 'CameraTag:Pinata', false, true, false, 0)
    EventFlowSystemActor.SoundDuckingOff(33)
    EventFlowSystemActor.FadeIn(true)
    # Tadaa! Look up! See that piñata? We made it!
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:020', false)
    MainNpc.EventFlags['cNpcTemp:PlayerBirthdayPinata2'] = true
 
flow Root_6_Pinata_2():
    # I think it came out real good. Even with me helping! Your present is inside it. So take this and use it to crack that piñata open!
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:021', false)
    MainNpc.SetDeliveryItemAtRandom(2829, false, 'cVillageRemakePattern', 0)
    MainNpc.NpcDelivery(1, 'Default')
    # Let me know when ya wanna get smackin' that piñata! Whenever you're ready!
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:022', true)
    MainNpc.EventFlags['cNpcTemp:PlayerBirthdayPinata2'] = false
    Player.PlayerBirthdayForbidStartUI(1)
 
flow Root_7_Cupcake_1():
    # Alright, <110:4>. Time to do this thing! First, go stand under the piñata…
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:023', true)
    EventFlowSystemActor.CameraSetDemoParam('cRoomNormal', 'cPinataStart', 'CameraTag:Pinata', false, true, false, 0)
    Player.PlayerMoveToTarget(false, 160.0, 170.0, 0.0, 0.0, true, 'cDemoTalk')
    fork:
        branch:
            MainNpc.TurnBody(10, 0.0)
        branch:
            Npc_1.TurnBody(10, 0.0)
        branch:
            Npc_2.TurnBody(10, 0.0)
    Player.TurnBody(12, 180.0)
    EventFlowSystemActor.WaitFrame(30)
    Player.EquipPinataStick()
    run Root_7_Cupcake_2()
 
flow Root_7_Cupcake_2():
    EventFlowSystemActor.CameraSetDemoParam('cRoomNormal', '', 'CameraTag:Pinata', false, true, false, 0)
    # Piñatas don't break with just a tap. Gotta hit it real fast, <110:5>! Whack it over and over and over… and over and over and over and over and over a…
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:024', true)
    MainNpc.Pinata(1)
    fork:
        branch:
            Player.PlayerPinataWait()
            System.EventFlags['cLandTemp:PlayerBirthdayPinataEnd'] = true
        branch:
            MainNpc.NpcPinataCheer()
        branch:
            Npc_1.NpcPinataCheer()
        branch:
            Npc_2.NpcPinataCheer()
    switch MainNpc.PinataResult():
        case 0:
            MainNpc.SetNumCupCake(10)
        case 1:
            MainNpc.SetNumCupCake(8)
        case 2:
            MainNpc.SetNumCupCake(6)
    MainNpc.Pinata(2)
    EventFlowSystemActor.CameraSetDemoParam('cPlayerBDPinataResult', 'cPinataStart', 'CameraTag:Pinata', false, true, false, 0)
    EventFlowSystemActor.WaitFrame(25)
    fork:
        branch:
            MainNpc.CharacterEmoticonAction('Clapping', false, '', 30, false)
        branch:
            Npc_1.CharacterEmoticonAction('Clapping', false, '', 30, false)
        branch:
            Npc_2.CharacterEmoticonAction('Clapping', false, '', 30, false)
    switch MainNpc.PinataResult():
        case 0:
            # That was cool, <110:3>. I didn't think you'd bust it open so quickly! Are you a master piñata buster? Do you train all year for this? What was inside…
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:027', true)
        case 1:
            # Wow, <110:4>… That was a real show of piñata-busting skill. And the present inside was… <item>birthday cupcakes!
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:026', true)
        case 2:
            # Good stuff! Ya did it! What was inside? Wow! There were <item>birthday cupcakes!
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:025', true)
    EventFlowSystemActor.SoundDuckingOn(33)
    EventFlowSystemActor.FadeOut('cCircle', 'cCircle', 'cBlack', 1.0, 1.0, false)
    fork:
        branch:
            MainNpc.CharacterEmoticonAction('EmotEnd', false, '', 1, false)
        branch:
            Npc_1.CharacterEmoticonAction('EmotEnd', false, '', 1, false)
        branch:
            Npc_2.CharacterEmoticonAction('EmotEnd', false, '', 1, false)
    MainNpc.Pinata(3)
    Player.PutawayPinataStick()
    Player.TurnBody(0, 0.0)
    MainNpc.EventFlags['cNpcTemp:PlayerBirthdayCupcake3'] = true
 
flow Root_7_Cupcake_3():
    MainNpc.DecideEventReward('cCupcake')
    MainNpc.SetDeliveryItem(1, false)
    MainNpc.NpcDelivery(17, 'Keep')
    EventFlowSystemActor.SoundDuckingOff(33)
    EventFlowSystemActor.FadeIn(true)
    if EventFlowSystemActor.ShoppingCapacity('cReward', 65534):
        # Here ya go, <110:3>! It's your <item>birthday cupcakes! It's our present to you!
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:028', false)
        MainNpc.NpcDelivery(10, 'Default')
        MainNpc.SetEventRewardToPlayerBaggage('cFree')
        Player.CharacterEmoticonAction('Smiling', false, '', 0, false)
        # We made a bunch, so you might not be able to finish them alone, <110:4>. I mean, I could eat them all, but I think the others would be happier if we …
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:029', false)
    else:
        if System.EventFlags['cPlayer:BirthdayPNotPresentFlag']:
            # Ohhh, your pockets are full, huh? No worries. I'll take 'em to your place. Just make sure you eat 'em while they're fresh! I mean, I'd eat it if it w…
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:030', false)
        else:
            # Oh, are your pockets full? No worries! I'll get this over to your place while it's still fresh!
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:031', false)
        MainNpc.NpcMailSendRandom('MAIL_XX_BirthDayP', 4, 6, 'cNone', 'cFastToday', 'cReward', true)
        MainNpc.NpcDelivery(3, 'Default')
    # So? Didja have fun? Kick back and take it easy for however long ya want, <110:5>!
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:032', true)
    MainNpc.EventFlags['cNpcTemp:PlayerBirthdayCupcake3'] = false
 
flow Root_8_Out():
    fork:
        branch:
            MainNpc.SetNpcFeel('cNormal', 0, false)
            # Leaving already? Today was really fun, wasn't it? We'll do it again next year, for sure!
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:033', true)
        branch:
            Npc_1.SetNpcFeel('cNormal', 0, false)
            Npc_1.TurnBody(10, 0.0)
            Npc_1.CharacterEmoticonAction('FaintSmile', false, '', 0, false)
        branch:
            Npc_2.SetNpcFeel('cNormal', 0, false)
            Npc_2.TurnBody(10, 0.0)
            Npc_2.CharacterEmoticonAction('FaintSmile', false, '', 0, false)
    System.EventFlags['cLandTemp:CanSetPlayerBirthdayCallNpc'] = false
    EventFlowSystemActor.ReservePlayerMutterDemo('Player_Demo_BirthdayP', 'Root', 'cNextOutDoorEnd', false)
    EventFlowSystemActor.SoundDuckingOff(21)
    fork:
        branch:
            MainNpc.CharacterEmoticonAction('Greeting', false, '', 0, false)
        branch:
            Npc_1.CharacterEmoticonAction('FaintSmile', false, '', 0, false)
        branch:
            Npc_2.CharacterEmoticonAction('FaintSmile', false, '', 0, false)
    EventFlowSystemActor.WaitFrame(20)
    Player.CharacterEmoticonAction('Greeting', false, '', 0, false)
    EventFlowSystemActor.WaitFrame(30)
    Player.CharacterEmoticonAction('EmotEnd', true, '', 0, false)
    EventFlowSystemActor.WaitFrame(10)
    fork:
        branch:
            Player.PlayerDemoMove('cNextInfoAngle', -3)
        branch:
            EventFlowSystemActor.WaitFrame(5)
            EventFlowSystemActor.NextGoTo('Entrance', 'cCircle', 'cCircle', 'cBlack', 1.0, 1.0)
 
flow Root_9_Stop2():
    switch EventFlowSystemActor.RandomChoiceExcludePrevious3(3, true):
        case 0:
            # <50:3><110:3>! You gotta try the piñata after all the work—and cupcakes—we put into it!
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:035', true)
        case 1:
            # <50:3><110:3>? Don't leave! You haven't tried the piñata yet… Don't ya wanna whack something with a blunt object?
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:036', true)
        case 2:
            # Hey, <110:3>?! Don't go home without smacking the piñata!
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/GEvent/BO_GEvent_BirthdayP_H:037', true)
    Player.PlayerDemoMove('cNextInfoAngle', 3)
 
flow Root_Init():
    if (System.EventFlags['cPlayer:BirthdayPCandleFlag']) and (not System.EventFlags['cLandTemp:PlayerBirthdayPinataEnd']):
        MainNpc.NpcAITalkCastSetting('PlayerBirthday')
 
