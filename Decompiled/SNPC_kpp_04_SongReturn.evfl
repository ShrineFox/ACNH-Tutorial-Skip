flow Root():
	EventFlowSystemActor.SoundDuckingOn(56)
	EventFlowSystemActor.CameraSetDemoParam('ReturnInStart', '', 'Npc:kpp', false, false, false, 0)
	EventFlowSystemActor.KappeiTourShowerTiming(880)
	EventFlowSystemActor.WaitFaderSleep()
	EventFlowSystemActor.CameraSetDemoParam('ReturnInEnd', 'ReturnIn', 'KeepFollow', false, false, false, 0)
	if EventFlowSystemActor.KappeiTourType('cStarPiece'):
		SubNpc.ChangeSeaWeather(170, 610, 240, 340, 0, 270)
	else:
		SubNpc.ChangeSeaWeather(170, 610, 240, 340, 0, 270)
	SubNpc.SettingKppReactionPlayer('cEnable')
	MainNpc.NpcRequestAction(4)
	MainNpc.KppBarcarollePrepare('ReturnA')
	EventFlowSystemActor.BGMPropertyControl(135)
	MainNpc.KppBarcarolleControl('ReturnA')
	if MainNpc.KppBarcarolleCancel():
		SubflowResults[0] = 0
		run SongCancel()
	else:
		SubNpc.SettingKppReactionPlayer('cDisable')
		MainNpc.NpcRequestAction(0)
		EventFlowSystemActor.MessageAutoPass(0, true)
		# RANDOM: Dig up anythin' good today? // If ye think it's all a dream…maybe it I… // A trip isn't over till ye're back home …
		MainNpc.OpenMessageWindow('TalkSNpc/kpp/Song/SP_kpp_Song_Return2:001', false)
		EventFlowSystemActor.WaitFrame(30)
		SubNpc.SettingKppReactionPlayer('cEnable')
		MainNpc.NpcRequestAction(4)
		MainNpc.KppBarcarollePrepare('ReturnB')
		EventFlowSystemActor.BGMPropertyControl(136)
		MainNpc.KppBarcarolleControl('ReturnB')
		if MainNpc.KppBarcarolleCancel():
			SubflowResults[0] = 1
			run SongCancel()
		else:
			EventFlowSystemActor.SoundDuckingOff(56)
			EventFlowSystemActor.CameraSetDemoParam('ReturnOut', 'ReturnOut', 'KeepFollow', false, false, false, 0)
			EventFlowSystemActor.WaitFrame(160)
			EventFlowSystemActor.SoundTriggerEmit('Boat_Stop', -1)
			EventFlowSystemActor.WaitFrame(10)
			run `00_System_StageChange`::ChangeStagerun `00_System_StageChange`::ChangeStage(FadeColorString='cBlack', TargetStage='cReturnFromKppTourIsland', FadeOutKindString='cCircle', FadeInKindString='cCircle', FadeOutSpeed=0.0, FadeInSpeed='cNormal')

flow Root_Init():
	MainNpc.NpcAITalkSubCastEntry('NpcPlayer', 1)

flow SongCancel():
	EventFlowSystemActor.BGMPropertyControl(130)
	SubNpc.SettingKppReactionPlayer('cDisable')
	MainNpc.NpcRequestAction(0)
	EventFlowSystemActor.AcceptFlowSwitchTag()
	fork:
		branch:
			EventFlowSystemActor.MessageAutoPass(0, true)
			if SubflowResults@2[0] == 0:
				# RANDOM: Yar? Ye be wantin' to return to yer isl… // Yar har har! Ye gettin' homesick? Well,… // How dare ye? I'm here havin' a good sin… // Say it ain't so! Ye wouldn't stop an ol…
				MainNpc.OpenMessageWindow('TalkSNpc/kpp/Song/SP_kpp_Song_Cancel:003', false)
			else:
				# RANDOM: Avast, ye squirrelly squid! Ye wanna en… // There be only a wee bit more song… Ye n… // We be almost thar, ye know… So I'm gonn… // If ye need to use th' bathroom, yer out…
				MainNpc.OpenMessageWindow('TalkSNpc/kpp/Song/SP_kpp_Song_Cancel:004', false)
		branch:
			EventFlowSystemActor.WaitFlowSwitchTag()
			run `00_System_StageChange`::ChangeStagerun `00_System_StageChange`::ChangeStage(FadeColorString='cBlack', TargetStage='cReturnFromKppTourIsland', FadeOutKindString='cCircle', FadeInKindString='cCircle', FadeInSpeed='cNormal', FadeOutSpeed=-2.0)
	EventFlowSystemActor.SoundDuckingOff(56)
