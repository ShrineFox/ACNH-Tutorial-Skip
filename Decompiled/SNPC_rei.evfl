flow AnnaijoBuilt():
	if System.EventFlags['cPlayer:ReiGetReward3']:
		if EventFlowSystemActor.EnvHourCompare(0, 0, true, true) in (0, 1):
			# RANDOM: Another year, another Toy Day… It's alw… // So…do you think everyone liked the pres… // Isn't Toy Day the best?<10:4> I already…
			MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:080', false)
		else:
			# Whoa! Where has the time gone? Toy Day is already over! I guess ISLAND is just so nice that I lost track of time. I hope I get to come back next year…
			MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:081', false)
	elif not System.EventFlags['cPlayer:ReiStartQuest2']:
		if System.EventFlags['cPlayer:ReiGetReward1']:
			if (EventFlowSystemActor.EnvHourCompare(4, 59, true, true) in (0, 1)) and ((not EventFlowSystemActor.IsExistSantaPresentNpcSleeping()) or (EventFlowSystemActor.EnvTimeZone() in (`05:00-07:59`, `08:00-11:59`, `12:00-15:59`, `16:00-18:59`, `19:00-23:59`))):
				if EventFlowSystemActor.SystemHasBaggageSpace('cPocketBag') < 1:
					# You know, you've been such a help to me so far…it's only right that I share more of the joy with you! But I'll need to hand you something first. Can …
					MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:051', false)
				else:
					# Ah, you've lightened your load. That's great!
					MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:052', false)
					run Sub_Event28()
			else:
				# Hey, thanks for all of your help earlier, kid. I was going to ask you to help deliver gifts, but honestly? It's my favorite thing ever, so I was happ…
				MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:072_02', false)
				System.EventFlags['cPlayer:ReiGetReward3'] = true
		elif System.EventFlags['cPlayer:ReiFinishQuest1']:
			if EventFlowSystemActor.SystemHasBaggageSpace('cPocketBag') < 1:
				# Ho ho ho! Thank you very much! And here's a little something for…<10:4> Oh deer. Your pockets are full! Why don't you make a list of what's in your p…
				MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:027', false)
			else:
				# Ah, you've lightened the load! Now I can give you your reward… It's some <item>Toy Day stockings!
				MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:028', false)
				run Sub_Event67()
		elif not System.EventFlags['cPlayer:ReiStartQuest1']:
			if EventFlowSystemActor.EnvHourCompare(4, 59, true, true) in (0, 1):
				if System.EventFlags['cPlayer:ReiTalkFirst']:
					# Ho ho how's your Toy Day going so far? I hope it's merry as can be! Unfortunately, I've got a small problem that's not very merry at all… I forgot th…
					MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:019', false)
				else:
					# Ho ho ho! Happy holidays!<10:4> I'm Jingle, the black-nosed reindeer! This is the most special and exciting time of the year, isn't it? And today is …
					MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:001', false)
					System.EventFlags['cPlayer:ReiTalkFirst'] = true
					# So, ho ho how's your Toy Day going so far? I hope it's merry as can be! Unfortunately, I've got a small problem that's not very merry at all… I forgo…
					MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:020', false)
				if not System.EventFlags['cPlayer:MainmenuRecipe']:
					# Ho HO! I just had a thought. I hear Tom Nook runs a keen DIY workshop. If you wouldn't mind, could you pay Resident Services a visit and try it out? …
					MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:023', false)
				elif EventFlowSystemActor.SystemHasBaggageSpace('cPocketBag') < 1:
					# Ho HO! I just had a thought. Something about DIY… Why not? Ah, but your pockets are full. Is there any way you could make space for at least one item…
					MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:021_2', false)
				else:
					# Ho HO! I just had a thought. Something about DIY… Why not? What do you say, kid? Can you help? It would behoove the both of us… even though I'm kinda…
					MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:021_1', false)
					MainNpc.NpcSetRewardRecipe(13792, false)
					MainNpc.SetDeliveryItem(1, true)
					MainNpc.NpcDelivery(1, 'Default')
					System.EventFlags['cPlayer:ReiStartQuest1'] = true
					# I just need 3 pieces of this special wrapping paper. Ho ho ho! You're saving Toy Day, kid!
					MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:022', false)
			else:
				# Whoa! Where has the time gone? Toy Day is already over! I guess ISLAND is just so nice that I lost track of time. I hope I get to come back next year…
				MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:081', false)
				System.EventFlags['cPlayer:ReiTalkFirst'] = true
		elif EventFlowSystemActor.HasTargetItem(13792, 3):
			# Ho ho! All finished crafting the wrapping paper? Mind if I take them from you?
			MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:025', false)
			if EventFlowSystemActor.GeneralTalkChoice2() == 0:
				MainNpc.SetDeliveryItemAtRandom(13792, false, 'cVillageRemakePattern', 0)
				MainNpc.NpcDelivery(0, 'Default')
				EventFlowSystemActor.DeleteTargetItem(13792, 3, true)
				System.EventFlags['cPlayer:ReiFinishQuest1'] = true
				if EventFlowSystemActor.SystemHasBaggageSpace('cPocketBag') < 1:
					# Ho ho ho! Thank you very much! And here's a little something for…<10:4> Oh deer. Your pockets are full! Why don't you make a list of what's in your p…
					MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:027', false)
				else:
					# Ho ho ho! Thank you very much! And here's a little something for you. A set of <item>Toy Day stockings!
					MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:026', false)
					run Sub_Event67()
			else:
				# I see. I'm a sad little reindeer…
				MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:030', false)
		else:
			# You'll need ornaments to craft the wrapping paper, but you can shake a decorated cedar tree to find those. I think 3 pieces of wrapping paper should …
			MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:024', false)
	elif EventFlowSystemActor.CheckChristmasSantaPresentsProgress(false, 2):
		# Ho ho! How do the deliveries go?
		MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:057', false)
		if EventFlowSystemActor.GeneralTalkChoice2() != 0:
			# Yes, the magic doesn't make itself, does it? Well, you've been working hard, and you deserve a break! Just remember—you have until 5 AM to finish all…
			MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:058', false)
		elif System.EventFlags['cPlayer:ReiGetReward2']:
			# Ho ho hmm, let's see here…<10:4> You're all done! Each and every present is exactly where it should be. Ahh…I can feel the Toy Day magic and joy radi…
			MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:068', false)
			run ReturnBigbag()
			# You helped me out a lot, you know? I think I've got one more little gift for you, kid. <10:4>Your own <item>Toy Day sleigh!
			MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:071', false)
			run Sub_Event91()
		elif EventFlowSystemActor.SystemHasBaggageSpace('cPocketBag') < 1:
			# Wow! You've already delivered everything to everyone? Well, I've got some fun stuff for you, but it doesn't look like you have room to take it right …
			MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:077', false)
		else:
			# Ho ho hmm, let's see here…<10:4> You're all done! Each and every present is exactly where it should be. Ahh…I can feel the Toy Day magic and joy radi…
			MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:073', false)
			run ReturnBigbag()
			# I'm so thankful that I could share the magic of Toy Day with you…but it's not just all talk. I have gifts for you! First up is a little recipe that I…
			MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:074', false)
			MainNpc.NpcSetRewardRecipe(13244, false)
			MainNpc.SetDeliveryItem(1, true)
			MainNpc.NpcDelivery(1, 'Default')
			System.EventFlags['cPlayer:ReiGetReward2'] = true
			# And then…something extra special… Your very own <item>Toy Day sleigh!
			MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:076', false)
			run Sub_Event91()
	elif EventFlowSystemActor.CheckChristmasSantaPresentsProgress(false, 1):
		# Hey there, kid! How are the deliveries going?
		MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:057_01', false)
		if EventFlowSystemActor.GeneralTalkChoice2() != 0:
			# Yes, the magic doesn't make itself, does it? Well, you've been working hard, and you deserve a break! Just remember—you have until 5 AM to finish all…
			MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:058', false)
		elif System.EventFlags['cPlayer:ReiGetReward2']:
			if EventFlowSystemActor.EnvHourCompare(4, 59, true, true) not in (0, 1):
				# Say, what time is it?<10:4> YIKES! I'm afraid I've spent too much time here on ISLAND. This little reindeer needs to hoof it, so I'll take care of de…
				MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:068_02', false)
				run Sub_Event88()
			elif (EventFlowSystemActor.IsExistSantaPresentNpcSleeping()) and (EventFlowSystemActor.EnvTimeZone() not in (`05:00-07:59`, `08:00-11:59`, `12:00-15:59`, `16:00-18:59`, `19:00-23:59`)):
				# Oh deer… It seems like at least one of your neighbors fell asleep before you could deliver their gift! That's so cute. Don't worry at all about it—I'…
				MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:068_01', false)
				run Sub_Event88()
			else:
				# Ho ho hmm, let's see here…<10:4> You're well on your way, kid! Wondering how many gifts are left in your magic bag? You can check by opening your poc…
				MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:067', false)
		elif EventFlowSystemActor.SystemHasBaggageSpace('cPocketBag') < 1:
			# Ho ho hmm, let's see here…<10:4> You've delivered more than half of the gifts I brought! That's the spirit! You're doing great! And if you had room t…
			MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:065', false)
		else:
			# Ho ho hmm, let's see here…<10:4> You've delivered more than half of the gifts I brought! That's the spirit! You're doing great! And here's a little d…
			MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:061', false)
			MainNpc.NpcSetRewardRecipe(13244, false)
			MainNpc.SetDeliveryItem(1, true)
			MainNpc.NpcDelivery(1, 'Default')
			System.EventFlags['cPlayer:ReiGetReward2'] = true
			if EventFlowSystemActor.EnvHourCompare(4, 59, true, true) not in (0, 1):
				# Say, what time is it?<10:4> YIKES! I'm afraid I've spent too much time here on ISLAND. This little reindeer needs to hoof it, so I'll take care of de…
				MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:068_02', false)
				run Sub_Event108()
			elif (EventFlowSystemActor.IsExistSantaPresentNpcSleeping()) and (EventFlowSystemActor.EnvTimeZone() not in (`05:00-07:59`, `08:00-11:59`, `12:00-15:59`, `16:00-18:59`, `19:00-23:59`)):
				# Oh deer… It seems like at least one of your neighbors fell asleep before you could deliver their gift! That's so cute. Don't worry at all about it—I'…
				MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:068_01', false)
				run Sub_Event108()
			else:
				# Wondering how many gifts are left in your magic bag? You can check by opening your pockets! Keep up the good work, kid!
				MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:066', false)
	else:
		# Hey there, kid! How are the deliveries going?
		MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:057_02', false)
		if EventFlowSystemActor.GeneralTalkChoice2() != 0:
			# Yes, the magic doesn't make itself, does it? Well, you've been working hard, and you deserve a break! Just remember—you have until 5 AM to finish all…
			MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:058', false)
		elif EventFlowSystemActor.CheckChristmasSantaPresentsProgress(false, 0):
			if EventFlowSystemActor.EnvHourCompare(4, 59, true, true) not in (0, 1):
				# Say, what time is it?<10:4> YIKES! I'm afraid I've spent too much time here on ISLAND. This little reindeer needs to hoof it, so I'll take care of de…
				MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:068_02', false)
				run Sub_Event129()
			elif (EventFlowSystemActor.IsExistSantaPresentNpcSleeping()) and (EventFlowSystemActor.EnvTimeZone() not in (`05:00-07:59`, `08:00-11:59`, `12:00-15:59`, `16:00-18:59`, `19:00-23:59`)):
				# Oh deer… It seems like at least one of your neighbors fell asleep before you could deliver their gift! That's so cute. Don't worry at all about it—I'…
				MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:068_01', false)
				run Sub_Event129()
			else:
				# Ho ho hmm, let's see here…<10:4> You're making progress, kid! Wondering how many gifts are left in your magic bag? You can check by opening your pock…
				MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:067_01', false)
		elif EventFlowSystemActor.EnvHourCompare(4, 59, true, true) not in (0, 1):
			# Say, what time is it?<10:4> YIKES! I'm afraid I've spent too much time here on ISLAND. This little reindeer needs to hoof it, so I'll take care of de…
			MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:068_02', false)
			run Sub_Event130()
		elif (EventFlowSystemActor.IsExistSantaPresentNpcSleeping()) and (EventFlowSystemActor.EnvTimeZone() not in (`05:00-07:59`, `08:00-11:59`, `12:00-15:59`, `16:00-18:59`, `19:00-23:59`)):
			# Oh deer… It seems like at least one of your neighbors fell asleep before you could deliver their gift! That's so cute. Don't worry at all about it—I'…
			MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:068_01', false)
			run Sub_Event130()
		else:
			# Ho ho hmm, let's see here… You've still got a long way to go! There's a ton of Toy Day joy left to deliver. And I mean presents, kid! I hate to think…
			MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:060', false)

flow AnnaijoTent():
	if System.EventFlags['cPlayer:ReiTalkFirst']:
		if System.EventFlags['cPlayer:ReiGetReward1']:
			if EventFlowSystemActor.EnvHourCompare(0, 0, true, true) == 0:
				# RANDOM: Another year, another Toy Day… It's alw… // So…do you think everyone liked the pres… // Isn't Toy Day the best?<10:4> I already…
				MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:080', false)
			else:
				# Whoa! Where has the time gone? Toy Day is already over! I guess ISLAND is just so nice that I lost track of time. I hope I get to come back next year…
				MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:081', false)
		else:
			run Sub_Event9()
	else:
		# Ho ho ho! Happy holidays!<10:4> I'm Jingle, the black-nosed reindeer! This is the most special and exciting time of the year, isn't it? And today is …
		MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:001', false)
		System.EventFlags['cPlayer:ReiTalkFirst'] = true
		run Sub_Event9()

flow ReturnBigbag():
	# Guess you won't be needing that <item>magic bag anymore. I'll go ahead and take it off your hands.
	MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:070', true)
	Player.PlayerUnequipPresentBag()
	EventFlowSystemActor.DeleteTargetItem(13836, 1, false)

flow Root():
	if EventFlowSystemActor.IsMyVillage():
		if EventFlowSystemActor.OfficeLevel() in (`ResServiceTent0`, `ResServiceTent1`):
			run AnnaijoTent()
		else:
			run AnnaijoBuilt()
	elif not System.EventFlags['cPlayer:ReiTalkFirst']:
		# Happy holidays! Say, you're not from around here, are you? <10:4>Well, that's alright. Happy Toy Day! I'm Jingle, the black-nosed reindeer! And I'm h…
		MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:100', false)
		System.EventFlags['cPlayer:ReiTalkFirst'] = true
	elif EventFlowSystemActor.EnvHourCompare(0, 0, true, true) == 0:
		# Ho ho hello! Taking this opportunity for a travel Toy Day, eh? Well…I'm not from around here either. I'm actually on a business trip. But I love my w…
		MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:101', false)
	else:
		# Whoa! Where has the time gone? Toy Day is already over! I guess ISLAND is just so nice that I lost track of time. I hope I get to come back next year…
		MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:081', false)

local flow Sub_Event108():
	run ReturnBigbag()
	# Hey, thanks for helping me prep gifts today. You were a really big help, kid! And I think all of your neighbors will be happy that you played a part …
	MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:072_01', false)
	System.EventFlags['cPlayer:ReiGetReward3'] = true

local flow Sub_Event129():
	run ReturnBigbag()
	# Hey, thanks for helping me prep gifts today. You were a really big help, kid! And I think all of your neighbors will be happy that you played a part …
	MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:072_01', false)
	System.EventFlags['cPlayer:ReiGetReward3'] = true

local flow Sub_Event130():
	run ReturnBigbag()
	# Hey, thanks for helping me prep gifts today. You were a really big help, kid! And I think all of your neighbors will be happy that you played a part …
	MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:072_01', false)
	System.EventFlags['cPlayer:ReiGetReward3'] = true

local flow Sub_Event28():
	# You know, you've been such a help to me so far…it's only right that I share more of the joy with you! That's right, kid. How'd you like to help me de…
	MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:050', true)
	EventFlowSystemActor.WaitFrame(5)
	EventFlowSystemActor.SetItemToPocket(13836, 1)
	Player.PlayerEquipPresentBag()
	EventFlowSystemActor.WaitFrame(40)
	System.EventFlags['cPlayer:ReiStartQuest2'] = true
	MainNpc.NpcDecideSantaMission()
	# That's a <item>magic bag. It's filled with gifts for each and every resident of this island. It's magical, see? All you have to do is visit each resi…
	MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:053', false)

local flow Sub_Event67():
	MainNpc.SetDeliveryItemAtRandom(13248, true, 'cRemakePattern0', 0)
	MainNpc.NpcDelivery(1, 'Default')
	System.EventFlags['cPlayer:ReiGetReward1'] = true
	if EventFlowSystemActor.PlayerHouseLevel() not in (`Homeless`, `PlacedTent`):
		# I wonder what might happen if you hung those in your home tonight…
		MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:029', false)
	if (EventFlowSystemActor.EnvHourCompare(4, 59, true, true) in (0, 1)) and ((not EventFlowSystemActor.IsExistSantaPresentNpcSleeping()) or (EventFlowSystemActor.EnvTimeZone() in (`05:00-07:59`, `08:00-11:59`, `12:00-15:59`, `16:00-18:59`, `19:00-23:59`))):
		if EventFlowSystemActor.SystemHasBaggageSpace('cPocketBag') < 1:
			# You know, you've been such a help to me so far…it's only right that I share more of the joy with you! But I'll need to hand you something first. Can …
			MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:051', false)
		else:
			run Sub_Event28()
	else:
		# Hey, thanks for helping me prep gifts today. You were a really big help, kid! And I think all of your neighbors will be happy that you played a part …
		MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:072_01', false)
		System.EventFlags['cPlayer:ReiGetReward3'] = true

local flow Sub_Event88():
	run ReturnBigbag()
	# Hey, thanks for helping me prep gifts today. You were a really big help, kid! And I think all of your neighbors will be happy that you played a part …
	MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:072_01', false)
	System.EventFlags['cPlayer:ReiGetReward3'] = true

local flow Sub_Event9():
	# Lucky you! You'll be the first one on ISLAND to get a gift. Here you go!
	MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:010', false)
	if EventFlowSystemActor.SystemHasBaggageSpace('cPocketBag') < 1:
		# Oh, what's this? You're more loaded down than a sleigh at the start of Toy Day! Won't you make enough room for just a single item and then come back …
		MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:012', false)
	else:
		MainNpc.SetDeliveryItemAtRandom(13248, true, 'cRemakePattern0', 0)
		MainNpc.WrapDeliveryItem('cPresentBox')
		MainNpc.NpcDelivery(1, 'Default')
		System.EventFlags['cPlayer:ReiGetReward1'] = true
		if EventFlowSystemActor.PlayerHouseLevel() not in (`Homeless`, `PlacedTent`):
			# I wonder what might happen if you hung those in your home tonight…
			MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:029', false)
		# May your Toy Day be filled with magic and joy. Ho ho ho! Happy holidays, kid!
		MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:011', false)

local flow Sub_Event91():
	MainNpc.SetDeliveryItemAtRandom(13241, true, 'cVillageRemakePattern', 0)
	MainNpc.NpcDelivery(1, 'Default')
	EventFlowSystemActor.SetMemoryEventPlayer('cBlancoEventPlayer:PE_ChristmasEvent_GetSled')
	System.EventFlags['cPlayer:ReiGetReward3'] = true
	# You helped make Toy Day extra- magical for everyone living on ISLAND, you know that? And, hey, I've said it before, but it still rings true…that make…
	MainNpc.OpenMessageWindow('TalkSNpc/rei/SP_rei:072', false)
