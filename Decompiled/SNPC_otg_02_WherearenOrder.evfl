flow FirstSelectExtention():
	if not System.EventFlags['cWherearenPlayer:SeqFirstSelectExtentionDone']:
		# Just in case you're worried, you can always expand to two floors later if you choose one floor now.
		MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_02_WherearenOrder:113_01', true)
		System.EventFlags['cWherearenPlayer:SeqFirstSelectExtentionDone'] = true

flow LocationTutorial():
	# Alright, now let's decide on the location for your vacation home. Have you given this any thought?
	MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_02_WherearenOrder:621', true)
	# Hmm, location…I know that's one of three important things in real estate, but I haven't thought about it at all! You got any ideas? And also, I forge…
	SubNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_WherearenEvent_Once:031', true)
	# Well then, we will prepare a location that is simply perfect for what you're looking for.
	MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_02_WherearenOrder:621_01', false)
	MainNpc.TurnNeck(10, true)
	EventFlowSystemActor.WaitFrame(12)
	Player.TurnNeck(1, false)
	# You can check the available plots on that map, PLAYER. Just choose a location you'd like to recommend, and let the client know.
	MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_02_WherearenOrder:622', true)
	Player.TurnNeck(11, true)
	EventFlowSystemActor.WaitFrame(10)
	run SelectField()
	# That spot looks real great! I can't wait to see it, <110:6>!
	SubNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_WherearenEvent_Once:032', true)
	MainNpc.TurnNeck(1, true)
	# Alright! For the next step in the process, you'll need to head to the site.
	MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_02_WherearenOrder:623', false)
	MainNpc.TurnNeck(10, true)
	EventFlowSystemActor.WaitFrame(12)
	Player.TurnNeck(1, false)
	# Would you mind accompanying the client there now, <110:3>? I know you're going to knock it out of the park!
	MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_02_WherearenOrder:624', true)
	System.EventFlags['cWherearenPlayer:SeqLocationTutorialDone'] = true
	run NewHouseOrderEnd()

flow MoveHouse():
	EventFlowSystemActor.SetWherearenPlayerRemoveBinderSeq(false, true)
	SubNpc.SetNpcName(0, 0)
	if SubNpc.WherearenIsNpcLiveTogether():
		# <20:4:002e004e0030003e004e0031002c004e0031003e004e0030002c004e0032003e004e0030002c00500030003e004e0031>Thank you for your order! So you'd like to mov…
		MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_02_WherearenOrder:201_01', false)
	else:
		# <20:4:0022004e0030003e004e0031002c004e0031003e004e0030002c00500030003e004e0031>So, you'd like to move your vacation home? How exciting! I can definit…
		MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_02_WherearenOrder:201', false)
	# Thanks for helping me out!
	SubNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenOrder:003_04', false)
	MainNpc.TurnNeck(10, false)
	if SubNpc.WherearenIsNpcLiveTogether():
		# <20:4:000a004e0030003e00500030>Alright, PLAYER…[target N1>P0,N2>P0] If you could pick a candidate for where our clients might move, that would be gre…
		MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_02_WherearenOrder:202_01', false)
	else:
		# <20:4:000a004e0030003e00500030>Alright, PLAYER.[target N1>P0] If you could pick a spot for our client, that would be great.
		MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_02_WherearenOrder:202', false)
	run SelectField()
	run PostSelectField()

flow NPC_CloseEmotion():
	EventFlowSystemActor.MessageSuspend()
	EventFlowSystemActor.CameraSetDemoParam('OrderCut1', 'OrderCameraRP', '', false, false, false, 0)
	EventFlowSystemActor.WaitFrame(30)
	fork:
		branch:
			run NPC_CloseEmotion_Player()
		branch:
			run NPC_CloseEmotion_Officer()
		branch:
			run NPC_CloseEmotion_Customer()
		branch:
			run NPC_CloseEmotion_MncOrHousemate()
	EventFlowSystemActor.WaitFrame(60)

flow NPC_CloseEmotion_Customer():
	if SubNpc.CheckNpcLook() in (0, 1, 4, 6):
		SubNpc.CharacterEmoticonAction('Clapping', true, '', 0, false)
	else:
		SubNpc.CharacterEmoticonAction('Smiling', true, '', 0, false)

flow NPC_CloseEmotion_MncOrHousemate():
	switch EventFlowSystemActor.WherearenNpcOrderType():
		case 1:
			run Sub_grp_Event110()
		case 3:
			if SubNpc.WherearenIsNpcLiveTogether():
				run Sub_grp_Event110()
		default:
			return

flow NPC_CloseEmotion_Officer():
	MainNpc.TurnNeck(10, false)
	MainNpc.CharacterEmoticonAction('Smiling', true, '', 0, false)

flow NPC_CloseEmotion_Player():
	EventFlowSystemActor.SoundDuckingOn(62)
	EventFlowSystemActor.SoundTriggerEmit('Demo_RequestOkay', -1)
	Player.CharacterEmoticonAction('RequestOkay', true, '', 0, false)
	EventFlowSystemActor.SoundDuckingOff(62)

flow NewHouse():
	EventFlowSystemActor.SetWherearenPlayerRemoveBinderSeq(false, true)
	SubNpc.SetNpcWherearenThemeTag(0)
	SubNpc.SetNpcName(0, 0)
	if EventFlowSystemActor.IsFirstWherearenOrderDemo():
		run NewHouseTutorial()
	elif System.EventFlags['cWherearenPlayer:SeqOtgSickOngoing']:
		run SNPC_mnc_03_WherearenOrder::NewHouse_OtgSick()
	else:
		if not EventFlowSystemActor.IsWherearenNpcOrderNewBuildType():
			# So, <115:9:cd00>… You'd like to not have a roommate and go back to having your own place, yes? Then let's move forward while I ask you about the kind…
			MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_02_WherearenOrder:301', false)
		# A huh huh! This is neat.
		SubNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenOrder:003_01', false)
		if System.EventFlags['cWherearenPlayer:ProposeNPCHouse']:
			run Sub_Event57()
		else:
			if System.EventFlags['cPlayerTemp:WHEREAREN_CallSNPCAmiibo']:
				System.EventFlags['cPlayerTemp:WHEREAREN_CallSNPCAmiibo'] = false
				run Sub_Event57()
			else:
				# So I was thinking it'd be nice if my vacation home was kinda like this…
				SubNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenOrder:003_02', true)
				run ShowOrder()
				# Oh, that's very nice. I really like your concept!
				MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_02_WherearenOrder:110', false)
				if System.EventFlags['cWherearenPlayer:SeqLocationTutorialDone']:
					MainNpc.TurnNeck(10, true)
					EventFlowSystemActor.WaitFrame(12)
					Player.TurnNeck(0, false)
					# Alright! Now, the next step is for you to choose an island for the client, PLAYER.
					MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_02_WherearenOrder:111', false)
					run SameLocationRemind()
					Player.TurnNeck(11, true)
					EventFlowSystemActor.WaitFrame(10)
					run Sub_Event66()
				else:
					run LocationTutorial()

flow NewHouseOrderEnd():
	Player.TurnNeck(1, false)
	System.EventFlags['cPlayerTemp:WHEREAREN_CustomerTalkReserve_Garden'] = true
	run NPC_CloseEmotion()
	EventFlowSystemActor.WherearenOrderCallback('cConfirm')
	run Demo_Common_Wherearen::SetCamera_GardenVisit()
	EventFlowSystemActor.BGMPropertyControl(140)
	EventFlowSystemActor.SetWherearenPlayerRemoveBinderSeq(false, true)
	EventFlowSystemActor.SoundTriggerEmit('WherearenFade_Boat', -1)
	if EventFlowSystemActor.IsSharehouseOrderCustomer():
		EventFlowSystemActor.ReserveEnterGardenPattern(3)
	else:
		EventFlowSystemActor.ReserveEnterGardenPattern(2)
	EventFlowSystemActor.SystemRequestChangeStage('cWherearenNpcGarden', 'cWherearen', 'cWherearen', 'cBlack', 1.0, 1.0)

flow NewHouseTutorial():
	EventFlowSystemActor.SystemBGMVolumeFadeIn(0.0, 0, 0.0)
	# Ah, the breeze is delightful here… What a wonderful spot to conduct business, <110:6>! So let's get to it. Shall I just go ahead and describe my visi…
	SubNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_02_WherearenOrder:601', true)
	# Yes, tell us all about it! Paint us a picture. Do you have any thoughts on how you'd like to spend time at your vacation home?
	MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_02_WherearenOrder:602', true)
	# I can think of nothing else! And I'm very particular. I have some furniture I'd like to use no matter what. You see…my ideal place is like…
	SubNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_02_WherearenOrder:603', true)
	run ShowOrder()
	# <50:3><150:0:cd00>, yes? That's a wonderful theme!
	MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_02_WherearenOrder:604', false)
	MainNpc.TurnNeck(10, true)
	EventFlowSystemActor.WaitFrame(12)
	Player.TurnNeck(0, false)
	# Our client has a dream. Please fulfill that dream, PLAYER!
	MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_02_WherearenOrder:605', true)
	MainNpc.TurnNeck(1, true)
	EventFlowSystemActor.WaitFrame(12)
	Player.TurnNeck(1, false)
	# As for the location…
	MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_02_WherearenOrder:606', true)
	# Well, I've had my eye on a particular small island near here. It's the one that looks like…
	SubNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_02_WherearenOrder:607', true)
	EventFlowSystemActor.BGMPropertyControl(141)
	# Oh yes! THAT island. Well then, you'll need to head to the site to complete the next step of the process.
	MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_02_WherearenOrder:608', true)
	MainNpc.TurnNeck(10, true)
	EventFlowSystemActor.WaitFrame(12)
	Player.TurnNeck(1, false)
	# Good luck with the client at the job site. Niko will take you by boat. Once you're on location, you can get to work right away. I can't wait to see h…
	MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_02_WherearenOrder:609', true)
	Player.TurnNeck(1, false)
	EventFlowSystemActor.SetWherearenNpcGardenIDDirect(32)
	System.EventFlags['cPlayerTemp:WHEREAREN_MncTalkReserve_Garden'] = true
	run NewHouseOrderEnd()

flow NotFade():
	MainNpc.NpcAISetting(9, true)
	Player.TurnNeck(11, false)
	switch EventFlowSystemActor.WherearenNpcOrderType():
		case 0:
			run NewHouse()
		case 3:
			run MoveHouse()
		default:
			return

flow NotFade_Init():
	run Root_Init()

flow PostSelectField():
	# Whoa! That spot looks cool! I can't wait to go there, <110:6>!
	SubNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenOrder:003_03', true)
	MainNpc.TurnNeck(1, true)
	if System.EventFlags['cWherearenPlayer:Unlock_Extension']:
		switch EventFlowSystemActor.WherearenNpcOrderType():
			case 0, 2:
				# The home we prepare for you can either have one floor or two floors. Which would you prefer?
				MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_02_WherearenOrder:113', false)
				run FirstSelectExtention()
				if SubNpc.EventFlags['cWherearenNpcMemory:ApproachOccurringFlag'] < 1:
					# Hmm, I dunno… Both sound good!<10:4> What do you think, <110:6>?
					SubNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenOrder:003', false)
				else:
					# Hmm, I dunno… I hadn't thought of that yet! Hey, what would you do?
					SubNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenOrder:006', false)
				if EventFlowSystemActor.GeneralTalkChoice2() == 0:
					# Good idea! I'll take me a one-floor home! It's easier to find all my stuff if it's all on the same floor!
					SubNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenOrder:004', false)
				else:
					# OK! Let's do two floors! It'll be like a double-decker sandwich, but kinda harder to chew!
					SubNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenOrder:005', false)
					Npc_1.WherearenExpandNpcHouse()
				# Now, <115:9:cd00>,[target N1>N0,P0>N1] we found a good location and settled on the floor plan, so it's time to head out! <20:4:000a004e0030003e005000…
				MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_02_WherearenOrder:114', false)
				run NewHouseOrderEnd()
			case 3:
				if SubNpc.WherearenIsNpcLiveTogether():
					# Now [target N1>N0,N2>N0,P0>N1]that we've found you a good location, why don't we head to the site, <115:9:cd00>? <20:4:000a004e0030003e00500030><50:3…
					MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_02_WherearenOrder:112_01', true)
					run NewHouseOrderEnd()
				else:
					run Sub_Event14()
			default:
				return
	else:
		run Sub_Event14()

flow Root():
	EventFlowSystemActor.SoundDuckingOn(51)
	EventFlowSystemActor.MessageSuspend()
	MainNpc.NpcAISetting(4, false)
	EventFlowSystemActor.CameraSetDemoParam('OrderCut0', '', '', false, false, true, 0)
	MainNpc.TurnNeck(1, false)
	SubNpc.TurnNeck(10, false)
	EventFlowSystemActor.WaitFrame(30)
	EventFlowSystemActor.SoundDuckingOff(54)
	EventFlowSystemActor.SystemBGMVolumeFadeIn(0.0, 0, 0.0)
	EventFlowSystemActor.BGMPropertyControl(137)
	EventFlowSystemActor.SoundFadeOutDuckingOff()
	EventFlowSystemActor.FadeIn(true)
	run NotFade()

flow Root_Init():
	if EventFlowSystemActor.WherearenNpcOrderType() in (0, 3):
		MainNpc.NpcAISetting(9, false)
		if (System.EventFlags['cWherearenPlayer:SeqOtgSickOngoing']) or (EventFlowSystemActor.WherearenNpcFreeQuery2('otg', 'cCustomer')):
			MainNpc.NpcAITalkCastSetting('WherearenOrder')

flow SameLocationRemind():
	if (System.EventFlags['cWherearenPlayer:NewBuildCount'] == 8) and (not System.EventFlags['cWherearenPlayer:SeqSameLocationRemindDone']):
		# Ah, and you may be aware of this already, but… You can choose the same location that you've already used for previous vacation homes.
		MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_02_WherearenOrder:191', false)
		System.EventFlags['cWherearenPlayer:SeqSameLocationRemindDone'] = true

flow SelectField():
	Player.PlayerStartLookDown()
	EventFlowSystemActor.SoundDuckingOn(63)
	fork:
		branch:
			EventFlowSystemActor.UIWherearenIslandsMapHandling('cSelectSection')
		branch:
			EventFlowSystemActor@sub.WaitFrame(60)
			Player.PlayerEndLookDown()
	EventFlowSystemActor.SoundDuckingOff(63)

flow ShowOrder():
	SubNpc.CharacterEmoticonAction('AbsentMindedness', true, '', 0, false)
	EventFlowSystemActor@Character.WaitFrame(4)
	EventFlowSystemActor.CameraSetDemoParam('OrderCut0_1', 'cDefault', '', false, false, true, 0)
	EventFlowSystemActor.WaitFrame(12)
	EventFlowSystemActor.UIHousingOrderListHandling()
	SubNpc.CharacterEmoticonAction('EmotEnd', true, '', 0, false)
	EventFlowSystemActor.CameraSetDemoParam('OrderCut0', 'cDefault', '', false, false, true, 0)
	EventFlowSystemActor.WaitFrame(24)

local flow Sub_Event14():
	# Now, <115:9:cd00>… [target N1>N0,P0>N1]We've found an excellent location for you. But you'll need to see it for yourself before we begin! <20:4:000a0…
	MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_02_WherearenOrder:112', true)
	run NewHouseOrderEnd()

local flow Sub_Event57():
	EventFlowSystemActor.WherearenSetNpcOrderFreeTheme()
	# <20:4:000a004e0030003e00500030><50:3>PLAYER[target N1>P0] will be coming up with the plans for the design this time.
	MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_02_WherearenOrder:104', false)
	# Oh! I like it! I don't think anybody's got a big round head more fulla ideas than yours!
	SubNpc.OpenMessageWindow('TalkNNpc/B1_Bo/OneRoom/BO_Spot_WherearenOrder:002', false)
	# <20:4:000a004e0030003e00500030>Alright! Now, the next step is to find a plot of land that works with the design you have in mind.
	MainNpc.OpenMessageWindow('TalkSNpc/otg/SP_otg_02_WherearenOrder:105', false)
	run Sub_Event66()

local flow Sub_Event66():
	run SelectField()
	run PostSelectField()

local flow Sub_grp_Event110():
	if Npc_2.CheckNpcLook() in (0, 1, 4, 6):
		Npc_2.CharacterEmoticonAction('Clapping', true, '', 0, false)
	else:
		Npc_2.CharacterEmoticonAction('Smiling', true, '', 0, false)
