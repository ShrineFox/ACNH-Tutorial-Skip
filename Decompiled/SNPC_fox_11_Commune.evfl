flow Chat():
    if System.EventFlags['cPlayer:FoxCommuneBuyArtTodayFlag']:
        switch EventFlowSystemActor.RandomChoiceExcludePrevious6EventFlowSystemActor.RandomChoiceExcludePrevious6(6, true):
            case 0:
                # You've got a real instinct for deals, you know that? I've lost count of how many folks come to me, then walk off in tears when they can't get a deal …
                MainNpc.OpenMessageWindowMainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_02_Commune:020', false)
            case 1:
                # I know how much you wanna get that art home, but you gotta be patient. We'll box it up real carefully and get it to you quick as we can. Meanwhile, w…
                MainNpc.OpenMessageWindowMainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_02_Commune:021', false)
            case 2:
                # I love seeing a customer's eyes light up when they see somethin' they want. Makes it all worth it. But don't get me wrong, the Bells are pretty nice …
                MainNpc.OpenMessageWindowMainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_02_Commune:028', false)
            case 3:
                # Seeing you travel so far out of your way to buy from me is really touchin'. When I give you a discount, it's 'cause I feel a personal connection. My …
                MainNpc.OpenMessageWindowMainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_02_Commune:029', false)
            case 4:
                # Just you wait. Next time I come to ISLAND, I'm bringin' my top-shelf deals!
                MainNpc.OpenMessageWindowMainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_02_Commune:030', false)
            case 5:
                # Buying art is all about love at first sight and going with your gut, don'tcha think? And yeah, sometimes that means you end up with something you wer…
                MainNpc.OpenMessageWindowMainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_02_Commune:023', false)
    elif System.EventFlags['cPlayer:FoxBuyTodayFlag']:
        if EventFlowSystemActor.RandomChoiceExcludePrevious2EventFlowSystemActor.RandomChoiceExcludePrevious2(2, true) == 0:
            # Just you wait. Next time I come to ISLAND, I'm bringin' my top-shelf deals!
            MainNpc.OpenMessageWindowMainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_02_Commune:030', false)
        else:
            # Buying art is all about love at first sight and going with your gut, don'tcha think? And yeah, sometimes that means you end up with something you wer…
            MainNpc.OpenMessageWindowMainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_02_Commune:023', false)
    elif System.EventFlags['cLand:FoxCommuneArtStockCount'] != 2:
        switch EventFlowSystemActor.RandomChoiceExcludePrevious6EventFlowSystemActor.RandomChoiceExcludePrevious6(6, true):
            case 0:
                # Art this delicate's gotta be handled with care, which is why my prices always include the cost of shipping. What's with the look? You didn't think sh…
                MainNpc.OpenMessageWindowMainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_02_Commune:022', false)
            case 1:
                # Let me tell ya, selling art is a tough business. The other day someone accused me of selling 'em a fake and wanted a refund. Can you believe it? Alri…
                MainNpc.OpenMessageWindowMainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_02_Commune:024', false)
            case 2:
                # You wouldn't believe how much interest there is in this stuff. It even surprises me sometimes! If you see something that's callin' out to you, jump o…
                MainNpc.OpenMessageWindowMainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_02_Commune:031', false)
            case 3:
                # When you've been at this as long as I have, you start to figure out a few things. Such as knowin' exactly what your customer wants and what a good de…
                MainNpc.OpenMessageWindowMainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_02_Commune:032', false)
            case 4:
                # You're a long way from home, cousin. Remember, deals today are gone tomorrow, so don't wait!
                MainNpc.OpenMessageWindowMainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_02_Commune:033', false)
            case 5:
                if System.EventFlags['cLand:FoxCommuneArtStockCount'] != 1:
                    # No touching the art, please. But if you see somethin' you're interested in, feel free to take a closer look. Just, you know, keep the closeness of th…
                    MainNpc.OpenMessageWindowMainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_02_Commune:027', false)
                else:
                    # If you're here to buy art, you better act fast! That's the last piece I have for today. It could go at any time!
                    MainNpc.OpenMessageWindowMainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_02_Commune:026', false)
    elif EventFlowSystemActor.RandomChoiceExcludePrevious2EventFlowSystemActor.RandomChoiceExcludePrevious2(2, true) == 0:
        # Sorry to tell ya, but I've already sold all the art I brought with me today. But don't you worry—Redd's Raffle is still open for business!
        MainNpc.OpenMessageWindowMainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_02_Commune:025', false)
    else:
        # I don't know what to tell ya! All of my art just flew off the proverbial shelves today. I even tried to save one for ya. I told 'em! I said, "No! I'm…
        MainNpc.OpenMessageWindowMainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_02_Commune:034', false)
 
flow Close():
    if EventFlowSystemActor.EnvHourCompareEventFlowSystemActor.EnvHourCompare(1, -1, true, true) in (1, 2):
        Player.TurnBodyPlayer.TurnBody(0, 0.0)
        MainNpc.NpcAISettingMainNpc.NpcAISetting(9, true)
        # Sorry, but I'm closed up for the night. You'll have to come back on another day. See ya then!
        MainNpc.OpenMessageWindowMainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_03_Commune_Lorrery:014', false)
        EventFlowSystemActor.ExitFlowchartEventFlowSystemActor.ExitFlowchart()
 
flow CommonTalk():
    if System.EventFlags['cPlayer:FoxTalkOnlyStandShopFlag']:
        System.EventFlags['cPlayer:FoxTalkOnlyStandShopFlag'] = false
    if System.EventFlags['cPlayer:FoxCommuneTalkTodayFlag']:
        run Close()
        if SubflowResults@3[0] == 2:
            # It's only <90:20:0000> a ticket, and each ticket nets a prize! Yep! Every ticket is a winner! Whaddaya say?
            MainNpc.OpenMessageWindowMainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_03_Commune_Lorrery:002', false)
    else:
        System.EventFlags['cPlayer:FoxCommuneTalkTodayFlag'] = true
        if System.EventFlags['cPlayer:FoxCommuneTalkExplainFlag']:
            run Close()
        else:
            Player.TurnBodyPlayer.TurnBody(0, 0.0)
            MainNpc.NpcAISettingMainNpc.NpcAISetting(9, true)
        if not System.EventFlags['cPlayer:TunekichiTalkBefore']:
            System.EventFlags['cPlayer:TunekichiTalkBefore'] = true
            # Oh! Why, I don't believe you and I have had the pleasure. The name's Redd. I work in sales. And you are…<10:4> <50:3>PLAYER! What a great name! Intel…
            MainNpc.OpenMessageWindowMainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_02_Commune:002', false)
            run Sub_Event32()
        elif (SubflowResults@3[0] in (0, 2)) or (not System.EventFlags['cPlayer:FoxCommuneTalkExplainFlag']):
            # Well, if it isn't PLAYER! How ya been?
            MainNpc.OpenMessageWindowMainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_03_Commune_Lorrery:001', false)
            if System.EventFlags['cPlayer:FoxCommuneTalkExplainFlag']:
                switch SubflowResults@3[0]:
                    case 0:
                        run Sub_grp_Event15()
                    case 2:
                        # It's only <90:20:0000> a ticket, and each ticket nets a prize! Yep! Every ticket is a winner! Whaddaya say?
                        MainNpc.OpenMessageWindowMainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_03_Commune_Lorrery:002', false)
                    default:
                        return
            else:
                run Sub_Event32()
 
flow Root():
    SubflowResults[0] = 0
    run CommonTalk()
    run Chat()
 
local flow Sub_Event32():
    System.EventFlags['cPlayer:FoxCommuneTalkExplainFlag'] = true
    System.EventFlags['cPlayer:FoxCommuneTalkBeforeFlag'] = true
    if System.EventFlags['cPlayer:TalkFoxCommuneOpenEvent']:
        if System.EventFlags['cPlayer:FoxCommuneTalkLotteryTodayFlag']:
            # As I'm sure you can see, I deal in fine goods here. And nothing's finer than fine art, am I right?
            MainNpc.OpenMessageWindowMainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_02_Commune:003', false)
        else:
            # As I'm sure you can see, I deal in fine goods here. And nothing's finer than fine art, am I right?
            MainNpc.OpenMessageWindowMainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_02_Commune:004', false)
    else:
        # As I'm sure you can see, I deal in fine goods here. And nothing's finer than fine art, am I right?
        MainNpc.OpenMessageWindowMainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_02_Commune:005', false)
    # Of course, stock is always an issue when it comes to finery, so I gotta limit you to 1 piece of art per day. But tell you what! Since we're family, p…
    MainNpc.OpenMessageWindowMainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_02_Commune:006', false)
    # And that's not all! Let's say fine art's not to your taste or budget. Or you just feel like having a little fun. I'm offering YOU, my favorite cousin…
    MainNpc.OpenMessageWindowMainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_02_Commune:007', false)
    if EventFlowSystemActor.EnvHourCompareEventFlowSystemActor.EnvHourCompare(1, -1, true, true) == 0:
        if SubflowResults@3[0] in (0, 1):
            run Sub_grp_Event15()
        else:
            # And since that's where you went first, I'm gonna say a little fun is just what you're after! It's only <90:20:0000> a ticket, and each ticket nets a …
            MainNpc.OpenMessageWindowMainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_02_Commune:011', false)
    else:
        # OH! Would you look at the time! I'm sorry, but we're actually closed. How do I make this right… I know! Next time we meet, I'm gonna show you a whole…
        MainNpc.OpenMessageWindowMainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_02_Commune:012', false)
        EventFlowSystemActor.ExitFlowchartEventFlowSystemActor.ExitFlowchart()
 
local flow Sub_grp_Event15():
    if (not System.EventFlags['cPlayer:FoxBuyArtTodayFlag']) and (System.EventFlags['cLand:FoxCommuneArtStockCount'] < 2):
        if System.EventFlags['cLand:FoxCommuneArtStockCount'] < 1:
            # That's enough chitchat. Let's get down to brass tacks. I've got works by the great masters ready to ship. Give 'em a look, and let me know if you hav…
            MainNpc.OpenMessageWindowMainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_02_Commune:008', false)
        else:
            # Now, to business! Let's talk about how you're about to treat yourself to some very fine art. I'm afraid I've only got one piece left, but it's a beau…
            MainNpc.OpenMessageWindowMainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_02_Commune:009', false)
    else:
        # Now, I can't sell you any more art today, but that doesn't gotta be a bad thing. I say it only means more time and more Bells that you can use to pla…
        MainNpc.OpenMessageWindowMainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox_02_Commune:010', false)
    EventFlowSystemActor.ExitFlowchartEventFlowSystemActor.ExitFlowchart()
 
