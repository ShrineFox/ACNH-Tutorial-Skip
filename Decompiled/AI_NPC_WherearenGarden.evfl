flow EnterGardenDemoCheck():
    if (System.EventFlags['cPlayerTemp:WHEREAREN_CustomerTalkReserve_Garden']) and (MainNpc.IsStartEnterDemoNpc()):
        MainNpc.NpcAISetting(3, false)
        MainNpc.NpcAISetting(2, false)
        run AI_NPC_Common::ContinueSpeakrun AI_NPC_Common::ContinueSpeak(FlowName='NNPC_Spot_WherearenGarden', EntryName='VisitTogether')
        EventFlowSystemActor.ExitFlowchartEventFlowSystemActor.ExitFlowchart()
 
flow GoOut():
    MainNpc.NpcChangeAIState('cLeaveHome', '', '', '', false, false)
 
flow Init():
    MainNpc.NpcDisableServiceMotion()
    MainNpc.ServiceMotionControl(false)
    if EventFlowSystemActor.FlagSystemIntValue3(3, 'cWherearenPlayer:RequestEndShareHouseDemo') == 0:
        MainNpc.NpcRegistAIBlackBoard('LeaveHome', 0)
        MainNpc.NpcRegistAIBlackBoard('CompleteDemoEnd', 0)
        MainNpc.NpcRegistAIBlackBoard('ReformStart', 0)
    else:
        MainNpc.NpcAISetting(2, false)
        MainNpc.NpcAISetting(4, false)
        MainNpc.NpcAISetting(3, false)
 
flow NotForceTalk():
    switch EventFlowSystemActor.WherearenOrderStatus():
        case 0, 4:
            MainNpc.NpcAIDefaultSetting(1)
            MainNpc.SetNpcTalkFlowName('NNPC_Spot_WherearenGarden', 'PlayerVisit')
            MainNpc.ChangeHouseMode()
        case 2:
            MainNpc.NpcSetAIBlackBoard('LeaveHome', 1)
            MainNpc.NpcAIDefaultSetting(1)
            MainNpc.SetNpcTalkFlowName('NNPC_Spot_WherearenGardenWork', 'UnderOrder')
            MainNpc.ChangeEditMode()
        case 3, 6:
            MainNpc.NpcAIDefaultSetting(1)
            MainNpc.SetNpcTalkFlowName('NNPC_Spot_WherearenGardenWork', 'UnderShooting')
            MainNpc.ChangeHouseMode()
        default:
            return
 
flow Root():
    run EnterGardenDemoCheck()
    switch MainNpc.WherearenNpcOrderRelationKind():
        case 0:
            if System.EventFlags['cPlayerTemp:WHEREAREN_MncTalkReserve_AfterCompleteDemo'] <= 0:
                switch EventFlowSystemActor.FlagSystemIntValue3(3, 'cWherearenPlayer:RequestEndShareHouseDemo'):
                    case 0:
                        run NotForceTalk()
                    case 1:
                        run AI_NPC_Common::ContinueSpeakrun AI_NPC_Common::ContinueSpeak(FlowName='NNPC_Spot_WherearenEndShareHouseDemo', EntryName='Root')
                    case 2:
                        run AI_NPC_Common::ContinueSpeakrun AI_NPC_Common::ContinueSpeak(FlowName='NNPC_Spot_WherearenEndShareHouseDemo', EntryName='FromHouse')
            elif MainNpc.NpcBlackBoard('CompleteDemoEnd', 1):
                MainNpc.NpcSetAIBlackBoard('CompleteDemoEnd', 0)
                run AI_NPC_Common::ContinueSpeakrun AI_NPC_Common::ContinueSpeak(FlowName='NNPC_Spot_WherearenGardenWork', EntryName='ForceTalk_PostCameraDemo_Direct')
            else:
                if not EventFlowSystemActor.SystemCheckNowStage('cWherearenNpcGarden'):
                    MainNpc.NpcAISetting(4, false)
                    MainNpc.NpcAISetting(21, true)
                    EventFlowSystemActor.CameraReserveFirstStateCommand('Demo:LandingTalk', 'Place:SafeArea', false)
                run AI_NPC_Common::ContinueSpeakrun AI_NPC_Common::ContinueSpeak(FlowName='NNPC_Spot_WherearenGardenWork', EntryName='ForceTalk_PostCameraDemo')
        case 1, 3:
            run NotForceTalk()
        default:
            return
 
